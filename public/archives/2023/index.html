<!DOCTYPE html>

<html lang="zh-CN">

<head>
  
  <meta name="baidu-site-verification" content="code-J1Qg17G6wT" />
  <title>文章归档：2023 - 向阳信息</title>
  <meta charset="UTF-8">
  <meta name="description" content="若月千鸮的博客&#39;">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  
  

    <!-- Site Verification -->
    <meta name="baidu-site-verification" content="code-8gmJzopb3Z" />

  <link rel="shortcut icon" href="/images/head/head.jpg" type="image/png" />
  <meta name="description" content="若月千鸮的博客&#39;">
<meta property="og:type" content="website">
<meta property="og:title" content="向阳信息">
<meta property="og:url" content="https://xyxsw.ltd/archives/2023/index.html">
<meta property="og:site_name" content="向阳信息">
<meta property="og:description" content="若月千鸮的博客&#39;">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="xyxsw">
<meta name="twitter:card" content="summary">
  <link rel="stylesheet" href="https://unpkg.com/highlight.js@9.15.8/styles/atom-one-dark.css" crossorigin>
  <link rel="stylesheet" href="/lib/mdui_043tiny/css/mdui.css">
  <link rel="stylesheet" href="/lib/iconfont/iconfont.css">
  <link rel="stylesheet" href="/lib/fancybox/css/jquery.fancybox.min.css">
  <link rel="stylesheet" href="https://unpkg.com/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css">
  
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2421060_8z08qcz5sq3.css">
  
  <link rel="stylesheet" href="/css/style.css?v=1695140390214">
  <script async defer src="https://analytics.umami.is/script.js" data-website-id="06ffa009-2f62-4496-8dff-f46e040421b3"></script>
  <meta name="msvalidate.01" content="B5491427B4527D50E571CC4251B08B3B" />
  <meta name="google-site-verification" content="NyHQaiTptpMk3XAHEF6njcM9lRfwxsJn-kxt5347_kQ" />
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/rss.xml" title="向阳信息" type="application/rss+xml">
</head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(/images/background/xiaomai.jpg)"></div>
    <div class="nexmoe-small" style="background-image: url(/images/background/lihui.png)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="xyxsw" class="mdui-btn mdui-btn-icon"><img src="/images/head/head.jpg" alt="xyxsw"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="xyxsw">
            <img src="/images/head/head.jpg" alt="xyxsw" alt="xyxsw">
        </a>
    </div>
    <div class="nexmoe-count">
        <div class="nexmoe-count-item"><span>文章</span>34 <div class="item-radius"></div><div class="item-radius item-right"></div> </div>
        <div class="nexmoe-count-item"><span>标签</span>3<div class="item-radius"></div><div class="item-radius item-right"></div></div>
        <div class="nexmoe-count-item"><span>分类</span>0<div class="item-radius"></div><div class="item-radius item-right"></div></div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-meishi"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/archives.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-hanbao1"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about.html" title="关于">
            <i class="mdui-list-item-icon nexmoefont icon-jiubei1"></i>
            <div class="mdui-list-item-content">
                关于
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/friend.html" title="朋友们">
            <i class="mdui-list-item-icon nexmoefont icon-cola"></i>
            <div class="mdui-list-item-content">
                朋友们
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
  
  
<!-- 站内搜索 -->

<div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search" >
        <form id="search-form">
            <label><input type="text" id="local-search-input" name="q" results="0" placeholder="站内搜索" class="input form-control" autocomplete="off" autocorrect="off"/></label>
            <!-- 清空/重置搜索框 -->
            <i class="fa fa-times" onclick="resetSearch()"></i>
        </form>
    </div>
    <div id="local-search-result"></div> <!-- 搜索结果区 -->
    <!-- <p class='no-result'></p> 无匹配时显示，注意在 CSS 中设置默认隐藏 -->
</div>


  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="http://wpa.qq.com/msgrd?v=3&uin=2907618001&site=qq&menu=yes" target="_blank" mdui-tooltip="{content: 'QQ'}" style="color: rgb(64, 196, 255);background-color: rgba(64, 196, 255, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="https://github.com/camera-2018" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a><a class="mdui-ripple" href="https://space.bilibili.com/13390475" target="_blank" mdui-tooltip="{content: 'Bilibili'}" style="color: rgb(251, 114, 153);background-color: rgba(251, 114, 153, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a>
    </div>
</div>
  
  

  
  
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/DN11/" style="font-size: 10px;">DN11</a> <a href="/tags/Linux%E5%AE%9E%E9%AA%8C/" style="font-size: 10px;">Linux实验</a> <a href="/tags/%E9%9D%92%E8%AE%AD%E8%90%A5%E7%AC%94%E8%AE%B0/" style="font-size: 20px;">青训营笔记</a>
    </div>
    
  </div>

  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章归档</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a><span class="archive-list-count">27</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


<style>
.nexmoe-widget .archive-list-count{
	position : absolute;
	right: 15px;
	top:9px;
	color: #DDD;
}
</style>

  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2023 xyxsw
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/tangyuxian/hexo-theme-tangyuxian" target="_blank">Tangyuxian</a><br/>
        <a href="http://beian.miit.gov.cn" target="_blank">津ICP备2021004845号</a><br/>
        
        <div style="font-size: 12px">
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            本站总访问量  <a id="busuanzi_value_site_pv"></a> 次<br />
            本站访客数<a id="busuanzi_value_site_uv"></a>人次
        </div>
        
        
    </div>

</div><!-- .nexmoe-drawer -->

  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <section class="nexmoe-posts">
    
    <div class="nexmoe-post">
        <a href="/2023/09/20/DN11%20%E4%BD%BF%E7%94%A8%20EBGP%20%E9%87%8D%E5%88%86%E5%8F%91%20IBGP%20OSPF%EF%BC%88%E5%90%8Cas%E5%86%85%E9%83%A8peer%EF%BC%89/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 24.305555555555554%;">
                    <img data-src="/images/background/xiaomai.jpg" data-sizes="auto" alt="DN11 使用 EBGP 重分发 IBGP OSPF（同as内部peer）" class="lazyload">
                    <h1>DN11 使用 EBGP 重分发 IBGP OSPF（同as内部peer）</h1>
                </div>
            
        </a>
        
        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2023年09月20日</a>
            <a><i class="nexmoefont icon-areachart"></i>877 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 4 分钟</a>
        </div>
        
        <article>
            
                <h1 id="DN11-使用-EBGP-重分发-IBGP-OSPF（同as内部peer）"><a href="#DN11-使用-EBGP-重分发-IBGP-OSPF（同as内部peer）" class="headerlink" title="DN11 使用 EBGP 重分发 IBGP OSPF（同as内部peer）"></a>DN11 使用 EBGP 重分发 IBGP OSPF（同as内部peer）</h1><h2 id="连接-wg-peer"><a href="#连接-wg-peer" class="headerlink" title="连接 wg peer"></a>连接 wg peer</h2><p>1.本地机器</p>
<pre><code class="nginx"># wg_aws.conf
[Interface]
# 你的私钥
PrivateKey = &lt;PRIVATEKAY&gt;
# 你开的端口号（注意防火墙）
ListenPort = &lt;PORT&gt;
PostUp = /sbin/ip addr add dev %i &lt;your ip&gt; peer &lt;peer ip&gt;
# 不创建路由（由路由协议接管）
Table = off

[Peer]
# 你对端的ip和端口（外网机器）
Endpoint = &lt;ENDPOINT&gt;:&lt;PORT&gt;
# 你对端的公钥（外网机器）
PublicKey = &lt;PUBLICKEY&gt; 
AllowedIPs = 0.0.0.0/0
</code></pre>
<p>2.外网机器</p>
<pre><code class="nginx"># wg_ts_home.conf
[Interface]
# 你的私钥
PrivateKey = &lt;PRIVATEKAY&gt;
# 你开的端口号（注意防火墙）
ListenPort = &lt;PORT&gt;
PostUp = /sbin/ip addr add dev %i &lt;your ip&gt; peer &lt;peer ip&gt;
# 不创建路由（由路由协议接管）
Table = off
# wg 默认的 MTU 是 1420 （这里主要排除外网机器 MTU 异常的问题，洞里打洞不要配这个）
MTU = 1420

[Peer]
# 你对端的ip和端口（本地机器）
Endpoint = &lt;ENDPOINT&gt;:&lt;PORT&gt;
# 你对端的公钥（本地机器）
PublicKey = &lt;PUBLICKEY&gt; 
AllowedIPs = 0.0.0.0/0
</code></pre>
<h2 id="bird配置"><a href="#bird配置" class="headerlink" title="bird配置"></a>bird配置</h2><p>创建</p>
<pre><code class="bash">/etc/bird.conf
/etc/bird/ospf.conf
/etc/bird/ibgp.conf
/etc/bird/bgp.conf
</code></pre>
<p>这四个文件</p>
<p>内网 openwrt 和外网机器上几乎需要相同的这四个文件（唯一不同的是 bgp neighbor 那里）</p>
<blockquote>
<p>文中的 172.16.3.254、172.16.3.91 改为你本机（你的本地机器或者外网机器）的隧道ip<br>文中的 4211112243 改为你的 asn （别整出俩 as 号就行）</p>
</blockquote>
<h3 id="x2F-etc-x2F-bird-conf"><a href="#x2F-etc-x2F-bird-conf" class="headerlink" title="&#x2F;etc&#x2F;bird.conf"></a>&#x2F;etc&#x2F;bird.conf</h3><pre><code class="nginx">log syslog all;
debug protocols all;

router id 172.16.3.254;

ipv4 table BGP_table;
ipv4 table OSPF_table;
ipv4 table IBGP_table;

protocol device&#123;

&#125;

protocol kernel&#123;
    ipv4 &#123;
        export all;
        import none;
    &#125;;
&#125;

include &quot;/etc/bird/ospf.conf&quot;;
include &quot;/etc/bird/ibgp.conf&quot;;
include &quot;/etc/bird/bgp.conf&quot;;

protocol pipe PIPE_OSPF_BGP&#123;
    table BGP_table;
    peer table OSPF_table;
    import all;
    export none;
&#125;

protocol pipe PIPE_BGP_MASTER4&#123;
    table master4;
    peer table BGP_table;
    import filter &#123;
        if source = RTS_STATIC then reject;
        krt_prefsrc = 172.16.3.254;
        accept;
    &#125;;
    export none;
&#125;

protocol pipe PIPE_IBGP_BGP &#123;
    table BGP_table;
    peer table IBGP_table;
    import filter &#123;
        if source = RTS_OSPF then reject;
        accept;
    &#125;;
    export filter &#123;
        if source = RTS_STATIC then reject;
        accept;
    &#125;;
&#125;

# 宣告 172.16.3.0/24 段
protocol static &#123;
    ipv4 &#123;
        table BGP_table;
        import all;
        export none;
    &#125;;

    # 只是为了让BGP的路由表里出现这条路由，不要担心 reject
    # 这个动作其实无所谓，reject 这个动作并不会被发到其他 AS
    # 后续将在导出到 master4 的时候删除这条路由，本地也不会有这一条
    # 请修改为你自己要宣告的段
    route 172.16.3.0/24 reject;
&#125;
</code></pre>
<h3 id="x2F-etc-x2F-bird-x2F-ibgp-conf"><a href="#x2F-etc-x2F-bird-x2F-ibgp-conf" class="headerlink" title="&#x2F;etc&#x2F;bird&#x2F;ibgp.conf"></a>&#x2F;etc&#x2F;bird&#x2F;ibgp.conf</h3><pre><code class="nginx">template bgp ibgp_peers &#123;
    local as 4211112243;
    source address 172.16.3.254;
    multihop;
    ipv4 &#123;
        next hop self;
        igp table OSPF_table;
        table IBGP_table;
        import all;
        export all;
    &#125;;
&#125;

protocol bgp ibgp_aws from ibgp_peers &#123;
    neighbor 172.16.3.91 internal;
&#125;
</code></pre>
<h2 id="bgp-conf"><a href="#bgp-conf" class="headerlink" title="bgp.conf"></a>bgp.conf</h2><pre><code class="nginx">template bgp BGP_peers &#123;
    local 172.16.3.254 as 4211112243;

    ipv4 &#123;
        table BGP_table;
        import all;
        export filter &#123;
            if source ~ [RTS_STATIC, RTS_BGP, RTS_OSPF] then accept;
            reject;
        &#125;;
    &#125;;
&#125;

# collector 配置
protocol bgp collect_self &#123;
    local as 4211112243;
    multihop;
    neighbor 172.16.255.1 as 4211110101;
    ipv4 &#123;
        add paths tx;
        table BGP_table;
        import none;
        export filter &#123;
            if source ~ [RTS_BGP,RTS_STATIC] then accept;
        &#125;;
    &#125;;
&#125;

# 如下的 neighbor 配置应按照 wg 实际链接数量为准
# 从模板定义一个BGP邻居
# protocol bgp protocol 名称 from 模板名称
protocol bgp baimeow from BGP_peers &#123;
   neighbor 172.16.4.254%baimeow as 4220084444;
&#125;

# 如下为 如果你有物理链路的 BGP 配置 （没有的别抄）
# protocol bgp Meva_phy from BGP_peers &#123;
#     source address 172.16.3.1;
#     neighbor 172.16.3.97%&#39;br-lan&#39; as 4211111024;
# 
#     ipv4 &#123;
#     import filter &#123;
#             if bgp_path ~ [= 4211111024 =] then bgp_local_pref = 120;
#             bgp_next_hop = 172.16.3.97;
#             accept;
#         &#125;;
#     &#125;;
# &#125;
</code></pre>
<h2 id="ospf-conf"><a href="#ospf-conf" class="headerlink" title="ospf.conf"></a>ospf.conf</h2><pre><code class="nginx">protocol ospf v2 ospf_aws &#123;
        ipv4 &#123;
                table OSPF_table;
                export all;
                import all;
        &#125;;
        area 0.0.0.0 &#123;
                interface &quot;wg_aws&quot; &#123;
                        cost 20;
                        type ptp;
                &#125;;
                interface &quot;lo&quot; &#123;
                        type bcast;
                &#125;;
        &#125;;
&#125;
</code></pre>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2023/08/30/go-zero%20api%E6%96%87%E4%BB%B6%20%EF%BD%9C%20%E9%9D%92%E8%AE%AD%E8%90%A5%E7%AC%94%E8%AE%B0/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 24.305555555555554%;">
                    <img data-src="/images/background/xiaomai.jpg" data-sizes="auto" alt="go-zero api文件生成项目框架 ｜ 青训营笔记" class="lazyload">
                    <h1>go-zero api文件生成项目框架 ｜ 青训营笔记</h1>
                </div>
            
        </a>
        
        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2023年08月30日</a>
            <a><i class="nexmoefont icon-areachart"></i>809 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 3 分钟</a>
        </div>
        
        <article>
            
                <h2 id="go-zero-api文件生成项目框架"><a href="#go-zero-api文件生成项目框架" class="headerlink" title="go-zero api文件生成项目框架"></a>go-zero api文件生成项目框架</h2><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p>.api文件是go-zero自创的文件格式，和protobuf的语法有很大不同，但好在不难理解。具体语法介绍可看官网文档：<a href="https://link.juejin.cn/?target=https://go-zero.dev/docs/tasks/dsl/api">go-zero.dev&#x2F;docs&#x2F;tasks&#x2F;…</a></p>
<p>先编写接口定义，然后直接一次性使用 goctl 生成代码。</p>
<p>api文件支持将一个数据结构嵌入另一个结构中，便于编写统一的响应格式。</p>
<p>首先定义空请求结构和基础的响应结构：</p>
<pre><code class="api">syntax = &quot;v1&quot;  
  
type Empty &#123;  
&#125;  
  
type BasicResponse &#123;  
    StatusCode int32 `json:&quot;status_code&quot;`  
    StatusMsg string `json:&quot;status_msg&quot;`  
&#125;
</code></pre>
<p>type关键字也支持代码块，只需要用<code>type()</code>包裹，就可以省去关键词。下面定义了注册和登录的请求和响应结构。</p>
<pre><code class="go">type (  
    RegisterRequest struct &#123;  
        Username string `form:&quot;username&quot;`  
        Password string `form:&quot;password&quot;`  
    &#125;  

    RegisterResponse struct &#123;  
        BasicResponse  
        UserId int64 `json:&quot;user_id&quot;`   
    &#125;  
)  
  
type (  
    LoginRequest struct &#123;  
        Username string `form:&quot;username&quot;`  
        Password string `form:&quot;password&quot;`  
    &#125;  

    LoginResponse struct &#123;  
        BasicResponse  
        UserId int64 `json:&quot;user_id&quot;`  
    &#125;  
)
</code></pre>
<p>最后还要定义一个获取用户信息的接口。因为本文不涉及创作、社交方面的业务逻辑实现，所以<code>User</code>结构其实没什么可以返回的信息。之后将其嵌入响应类型的<code>user</code>字段中：</p>
<pre><code class="go">type (  
    User &#123;  
        Id int64 `json:&quot;id&quot;`  
        Name string `json:&quot;name&quot;`  
    &#125;  
    
    GetUserInfoRequest struct &#123;  
        UserId int64 `form:&quot;user_id&quot;`   
    &#125;  

    GetUserInfoResponse struct &#123;  
        BasicResponse  
        User User `json:&quot;user&quot;`  
    &#125;  
)
</code></pre>
<h2 id="定义接口路由"><a href="#定义接口路由" class="headerlink" title="定义接口路由"></a>定义接口路由</h2><p>把所有api路由配置好</p>
<pre><code class="api">@server(  
    group: app  
)  
service app &#123;  
    @handler Ping  
    get /ping (Empty) returns (BasicResponse)  
&#125;  
  
@server(  
    group: user  
    prefix: /douyin/user  
)  
service app &#123;  
    @handler Register  
    post /register (RegisterRequest) returns (RegisterResponse)  
  
    @handler Login  
    post /login (LoginRequest) returns (LoginResponse)  
  
    @handler GetUserInfo  
    get / (GetUserInfoRequest) returns (GetUserInfoResponse)  
&#125;
</code></pre>
<p>以下几点需要注意：</p>
<ol>
<li>如果service代码块有多个，要求后面的名称（即“app”）相同</li>
<li>形如装饰器的@server代码块可以做代码分组、路由前缀、鉴权、中间件等多种配置。<ul>
<li>这里把路由分成app和user两组，之后生成时会分组放在文件夹里</li>
<li>给user组设置了<code>/douyin/user</code>的路由器前缀，就不用重复写了</li>
<li>鉴权和中间件配置下文会提到</li>
</ul>
</li>
<li>每个接口需要一个<code>handler</code>，其实就是给函数起名</li>
<li>接口定义的格式是 <code>&lt;HTTP方法&gt; &lt;子路径&gt; (&lt;请求数据结构&gt;) returns (&lt;响应数据结构&gt;) </code></li>
</ol>
<h2 id="创建项目模板"><a href="#创建项目模板" class="headerlink" title="创建项目模板"></a>创建项目模板</h2><p>这次不是新建示例项目，而是根据现有的api声明创建</p>
<p>安装 goctl</p>
<p><a target="_blank" rel="noopener" href="https://go-zero.dev/docs/tasks/installation/goctl">https://go-zero.dev/docs/tasks/installation/goctl</a></p>
<pre><code class="bash">$ GO111MODULE=on go install github.com/zeromicro/go-zero/tools/goctl@latest
</code></pre>
<p>安装 protoc</p>
<p><a target="_blank" rel="noopener" href="https://go-zero.dev/docs/tasks/installation/protoc">https://go-zero.dev/docs/tasks/installation/protoc</a></p>
<pre><code class="bash">$ goctl env check --install --verbose --force
</code></pre>
<pre><code class="shell">goctl api go --api app.api --dir=. --style=goZero 
</code></pre>
<p>这会在当前目录生成项目文件。之后进入目录安装依赖：</p>
<pre><code class="shell">go mod tidy
</code></pre>
<h2 id="测试Ping接口"><a href="#测试Ping接口" class="headerlink" title="测试Ping接口"></a>测试Ping接口</h2><p>Ping接口的逻辑在<code>internal/logic/app/pingLogic.go</code>，打开文件并编辑handler函数：</p>
<pre><code class="go">func (l *PingLogic) Ping(req *types.Empty) (resp *types.BasicResponse, err error) &#123;  
    return &amp;types.BasicResponse&#123;
        StatusCode: 0,
        StatusMsg:  &quot;pong&quot;,
    &#125;, nil
&#125;
</code></pre>
<p>这里的写法和rpc微服务有点区别。注意到传入的<code>resp</code>是一个指针，所以需要<strong>手动创建</strong>一个响应结构体并设置键值。</p>
<p>这样就算完成Ping接口了，可以运行服务。</p>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2023/08/30/gorm%E8%BF%9B%E9%98%B6%20%EF%BD%9C%20%E9%9D%92%E8%AE%AD%E8%90%A5%E7%AC%94%E8%AE%B0/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 24.305555555555554%;">
                    <img data-src="/images/background/xiaomai.jpg" data-sizes="auto" alt="gorm 进阶 ｜ 青训营笔记" class="lazyload">
                    <h1>gorm 进阶 ｜ 青训营笔记</h1>
                </div>
            
        </a>
        
        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2023年08月30日</a>
            <a><i class="nexmoefont icon-areachart"></i>1.3k 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 6 分钟</a>
        </div>
        
        <article>
            
                <h2 id="gorm"><a href="#gorm" class="headerlink" title="gorm"></a>gorm</h2><p>关于简单的 gorm 总结 可以看上一篇文章  gorm 初体验 ｜ 青训营笔记</p>
<h3 id="软删除"><a href="#软删除" class="headerlink" title="软删除"></a>软删除</h3><p><code>Gorm</code>提供了软删除的能力，需要在结构体中定义一个<code>Deleted</code>字段，此时再调用<code>Delete</code>删除函数，则会生成<code>update</code>语句，并将<code>deleted</code>字段赋值为当前删除时间。</p>
<pre><code class="go">type Product struct &#123;
    ID      uint
    Code    string
    Price   uint
    Deleted gorm.DeletedAt
&#125;
</code></pre>
<p>再次执行删除操作：</p>
<pre><code class="go">go
db.Delete(&amp;Product&#123;&#125;, 1)
</code></pre>
<p>生成的<code>sql</code>为：</p>
<pre><code class="sql">UPDATE `product` SET `deleted`=&#39;2023-01-30 22:22:22.202&#39; WHERE `product`.`id` = 1 AND `product`.`deleted` IS NULL
</code></pre>
<p>查询被软删除的操作，要使用<code>Unscoped</code>函数：</p>
<pre><code class="go">db.Unscoped().First(&amp;product, 2)
</code></pre>
<p>有了<code>DeleteAt</code>字段后，删除操作已经变成了更新操作，那么想要物理删除怎么办？也是使用<code>Unscoped</code>函数：</p>
<pre><code class="go">db.Unscoped().Delete(&amp;Product&#123;&#125;, 1)
</code></pre>
<h2 id="Gorm事务"><a href="#Gorm事务" class="headerlink" title="Gorm事务"></a>Gorm事务</h2><p><code>Gorm</code>提供了<code>Begin</code>、<code>Commit</code>、<code>Rollback</code>方法用于使用事务。</p>
<pre><code class="go">// 开启事务
tx := db.Begin()
if err := tx.Create(&amp;Product&#123;Code: &quot;D32&quot;, Price: 100&#125;).Error; err != nil &#123;
    // 出现错误回滚
    tx.Rollback()
    return
&#125;
if err := tx.Create(&amp;Product&#123;Code: &quot;D33&quot;, Price: 100&#125;).Error; err != nil &#123;
    // 出现错误回滚
    tx.Rollback()
    return
&#125;
// 提交事务
tx.Commit()
</code></pre>
<p>在开启事务后，调用增删改操作是应该使用开启事务返回的<code>tx</code>而不是<code>db</code>。</p>
<p><code>Gorm</code>还提供了<code>Transaction</code>函数用于自定提交事务，避免用户漏写<code>Commit</code>、<code>Rollback</code>。</p>
<pre><code class="go">if err = db.Transaction(func(tx *gorm.DB) error &#123;
    if err := db.Create(&amp;Product&#123;Code: &quot;D55&quot;, Price: 100&#125;).Error; err != nil &#123;
        return err
    &#125;
    if err := db.Create(&amp;Product&#123;Code: &quot;D56&quot;, Price: 100&#125;).Error; err != nil &#123;
        return err
    &#125;
    return nil
&#125;); err != nil &#123;
    return
&#125;
</code></pre>
<p>这种写法，当出现错误时会自动进行<code>Rollback</code>，当正常执行时会自动<code>Commit</code>。</p>
<h3 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h3><p>当我们想在执行增删改查操作前后做一些额外的操作时，可以使用<code>Gorm</code>提供的<code>Hook</code>能力。</p>
<p><code>Hook</code>是在创建、查询、更新、删除等操作之前、之后自动调用的函数，如果任何<code>Hook</code>返回错误，<code>Gorm</code>将停止后续的操作并回滚事务。</p>
<p><code>Hook</code>会开启默认事务，所以会带来了一些性能损失。</p>
<h3 id="性能提高"><a href="#性能提高" class="headerlink" title="性能提高"></a>性能提高</h3><p>对于写操作（创建、更新、删除），为了确保数据的完整性，<code>Gorm</code>会将他们封装在事务内运行，但是这样会降低性能，可以使用<code>SkipDefaultTransaction</code>关闭默认事务。</p>
<p>使用<code>PrepareStmt</code>缓存预编译语句可以提高后续调用的速度。</p>
<pre><code class="go">db, err := gorm.Open(sqlite.Open(&quot;gorm.db&quot;), &amp;gorm.Config&#123;
  SkipDefaultTransaction: true,
  PrepareStmt: true,
&#125;)
</code></pre>
<h2 id="Gorm生态"><a href="#Gorm生态" class="headerlink" title="Gorm生态"></a>Gorm生态</h2><p>Gorm拥有非常丰富的扩展生态，下面列举一些常用的扩展。</p>
<ul>
<li>代码生成工具:<a href="https://link.juejin.cn/?target=https://github.com/go-gorm/gen">github.com&#x2F;go-gorm&#x2F;gen</a></li>
<li>分片分库方案:<a href="https://link.juejin.cn/?target=https://github.com/go-gorm/sharding">github.com&#x2F;go-gorm&#x2F;sha…</a></li>
<li>手动索引:<a href="https://link.juejin.cn/?target=https://github.com/go-gorm/hints">github.com&#x2F;go-gorm&#x2F;hin…</a></li>
<li>乐观锁:<a href="https://link.juejin.cn/?target=https://github.com/go-gorm/optimisticlock">github.com&#x2F;go-gorm&#x2F;opt…</a></li>
<li>读写分离:<a href="https://link.juejin.cn/?target=https://github.com/go-gorm/dbresolver">github.com&#x2F;go-gorm&#x2F;dbr…</a></li>
<li>OpenTelemetry扩展:<a href="https://link.juejin.cn/?target=https://github.com/go-gorm/opentelemetry">github.com&#x2F;go-gorm&#x2F;ope…</a></li>
</ul>
<h2 id="GORM-配置"><a href="#GORM-配置" class="headerlink" title="GORM 配置"></a>GORM 配置</h2><p>GORM 提供的配置可以在初始化时使用</p>
<pre><code class="go">type Config struct &#123;
  SkipDefaultTransaction   bool
  NamingStrategy           schema.Namer
  Logger                   logger.Interface
  NowFunc                  func() time.Time
  DryRun                   bool
  PrepareStmt              bool
  DisableNestedTransaction bool
  AllowGlobalUpdate        bool
  DisableAutomaticPing     bool
  DisableForeignKeyConstraintWhenMigrating bool
&#125;
</code></pre>
<h3 id="跳过默认事务"><a href="#跳过默认事务" class="headerlink" title="跳过默认事务"></a>跳过默认事务</h3><p>为了确保数据一致性，GORM 会在事务里执行写入操作（创建、更新、删除）。如果没有这方面的要求，您可以在初始化时禁用它。</p>
<pre><code class="go">db, err := gorm.Open(sqlite.Open(&quot;gorm.db&quot;), &amp;gorm.Config&#123;
  SkipDefaultTransaction: true,
&#125;)
</code></pre>
<h3 id="命名策略"><a href="#命名策略" class="headerlink" title="命名策略"></a>命名策略</h3><p>GORM 允许用户通过覆盖默认的<code>NamingStrategy</code>来更改命名约定，这需要实现接口 <code>Namer</code></p>
<pre><code class="go">type Namer interface &#123;
    TableName(table string) string
    SchemaName(table string) string
    ColumnName(table, column string) string
    JoinTableName(table string) string
    RelationshipFKName(Relationship) string
    CheckerName(table, column string) string
    IndexName(table, column string) string
&#125;
</code></pre>
<p>默认 <code>NamingStrategy</code> 也提供了几个选项，如：</p>
<pre><code class="go">db, err := gorm.Open(sqlite.Open(&quot;gorm.db&quot;), &amp;gorm.Config&#123;
  NamingStrategy: schema.NamingStrategy&#123;
    TablePrefix: &quot;t_&quot;,   // table name prefix, table for `User` would be `t_users`
    SingularTable: true, // use singular table name, table for `User` would be `user` with this option enabled
    NoLowerCase: true, // skip the snake_casing of names
    NameReplacer: strings.NewReplacer(&quot;CID&quot;, &quot;Cid&quot;), // use name replacer to change struct/field name before convert it to db name
  &#125;,
&#125;)
</code></pre>
<h3 id="NowFunc"><a href="#NowFunc" class="headerlink" title="NowFunc"></a>NowFunc</h3><p>更改创建时间使用的函数</p>
<pre><code>db, err := gorm.Open(sqlite.Open(&quot;gorm.db&quot;), &amp;gorm.Config&#123;
  NowFunc: func() time.Time &#123;
    return time.Now().Local()
  &#125;,
&#125;)
</code></pre>
<h3 id="DryRun"><a href="#DryRun" class="headerlink" title="DryRun"></a>DryRun</h3><p>生成 <code>SQL</code> 但不执行，可以用于准备或测试生成的 SQL</p>
<pre><code>db, err := gorm.Open(sqlite.Open(&quot;gorm.db&quot;), &amp;gorm.Config&#123;
  DryRun: false,
&#125;)
</code></pre>
<h3 id="PrepareStmt"><a href="#PrepareStmt" class="headerlink" title="PrepareStmt"></a>PrepareStmt</h3><p><code>PreparedStmt</code> 在执行任何 SQL 时都会创建一个 prepared statement 并将其缓存，以提高后续的效率</p>
<pre><code>db, err := gorm.Open(sqlite.Open(&quot;gorm.db&quot;), &amp;gorm.Config&#123;
  PrepareStmt: false,
&#125;)
</code></pre>
<h3 id="禁用嵌套事务"><a href="#禁用嵌套事务" class="headerlink" title="禁用嵌套事务"></a>禁用嵌套事务</h3><p>在一个事务中使用 <code>Transaction</code> 方法，GORM 会使用 <code>SavePoint(savedPointName)</code>，<code>RollbackTo(savedPointName)</code> 为你提供嵌套事务支持，你可以通过 <code>DisableNestedTransaction</code> 选项关闭它</p>
<h3 id="DisableAutomaticPing"><a href="#DisableAutomaticPing" class="headerlink" title="DisableAutomaticPing"></a>DisableAutomaticPing</h3><p>在完成初始化后，GORM 会自动 ping 数据库以检查数据库的可用性，若要禁用该特性，可将其设置为 <code>true</code></p>
<pre><code>db, err := gorm.Open(sqlite.Open(&quot;gorm.db&quot;), &amp;gorm.Config&#123;
  DisableAutomaticPing: true,
&#125;)
</code></pre>
<h3 id="DisableForeignKeyConstraintWhenMigrating"><a href="#DisableForeignKeyConstraintWhenMigrating" class="headerlink" title="DisableForeignKeyConstraintWhenMigrating"></a>DisableForeignKeyConstraintWhenMigrating</h3><p>在 <code>AutoMigrate</code> 或 <code>CreateTable</code> 时，GORM 会自动创建外键约束，若要禁用该特性，可将其设置为 <code>true</code></p>
<pre><code>db, err := gorm.Open(sqlite.Open(&quot;gorm.db&quot;), &amp;gorm.Config&#123;
  DisableForeignKeyConstraintWhenMigrating: true,
&#125;)
</code></pre>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2023/08/28/go%E5%AD%97%E8%8A%82%E4%B8%89%E4%BB%B6%E5%A5%97%20%EF%BD%9C%20%E9%9D%92%E8%AE%AD%E8%90%A5%E7%AC%94%E8%AE%B0/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 24.305555555555554%;">
                    <img data-src="/images/background/xiaomai.jpg" data-sizes="auto" alt="go字节三件套 ｜ 青训营笔记" class="lazyload">
                    <h1>go字节三件套 ｜ 青训营笔记</h1>
                </div>
            
        </a>
        
        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2023年08月28日</a>
            <a><i class="nexmoefont icon-areachart"></i>671 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 3 分钟</a>
        </div>
        
        <article>
            
                <h2 id="Gorm、Kitex、Hertz：三件套介绍与基本用法"><a href="#Gorm、Kitex、Hertz：三件套介绍与基本用法" class="headerlink" title="Gorm、Kitex、Hertz：三件套介绍与基本用法"></a>Gorm、Kitex、Hertz：三件套介绍与基本用法</h2><h3 id="Gorm"><a href="#Gorm" class="headerlink" title="Gorm"></a>Gorm</h3><p>Gorm是Golang中广受欢迎的ORM（对象关系映射）框架，已经发展数十年，具有强大的功能和出色的性能。</p>
<p>ORM框架用于将面向对象的概念与数据库中的表相对应，简化数据操作过程。在Golang中，自定义的结构体与数据库表一一对应，结构体的实例对应表中的一条记录。</p>
<p>基本用法</p>
<p>定义结构体：在Gorm中，定义结构体来映射数据库表。</p>
<pre><code class="go">type User struct &#123;
  ID    uint   `gorm:&quot;primary_key&quot;`
  Name  string `gorm:&quot;type:varchar(100)&quot;`
  Email string `gorm:&quot;type:varchar(100);uniqueIndex&quot;`
&#125;
</code></pre>
<p>增加数据：使用Create方法来新增数据条目。</p>
<pre><code class="go">db.Create(&amp;User&#123;Name: &quot;John&quot;, Email: &quot;john@example.com&quot;&#125;)
</code></pre>
<p>查询数据：使用Find进行数据查找，可以通过Where和Or条件构建查询条件。</p>
<pre><code class="go">var user User
db.Where(&quot;name = ?&quot;, &quot;John&quot;).First(&amp;user)
</code></pre>
<p>更新数据：使用Update进行数据更新，可以使用Model结合Update或Updates方法来更新列。</p>
<pre><code class="go">db.Model(&amp;user).Update(&quot;Name&quot;, &quot;John Updated&quot;)
</code></pre>
<p>删除数据：使用Delete进行数据删除操作，根据是否包含gorm.deletedat字段执行物理或逻辑删除。</p>
<pre><code class="go">db.Delete(&amp;user)
</code></pre>
<h3 id="Kitex"><a href="#Kitex" class="headerlink" title="Kitex"></a>Kitex</h3><p><a target="_blank" rel="noopener" href="https://www.cloudwego.io/zh/docs/kitex/overview/">https://www.cloudwego.io/zh/docs/kitex/overview/</a></p>
<p>Kitex是字节开发的高性能Golang微服务RPC框架，具备出色的可扩展性和高性能。<br>服务端</p>
<pre><code class="go">func main() &#123;
  srv := kitex.NewServer(new(YourServiceImpl), 
                          kitex.WithServiceAddr(&quot;:8888&quot;))
  srv.Run()
&#125;
</code></pre>
<p>客户端</p>
<pre><code class="go">func main() &#123;
  client := NewYourServiceClient(&quot;127.0.0.1:8888&quot;, kitex.WithTransportProtocol(protocol.TRPC))
  // 调用RPC方法
&#125;
</code></pre>
<p>高性能：Kitex具有优异的性能表现，适用于高负载的微服务场景。<br>可扩展：支持多协议，并且有丰富的开源扩展库，可以满足各种需求。</p>
<h3 id="Hertz"><a href="#Hertz" class="headerlink" title="Hertz"></a>Hertz</h3><p><a target="_blank" rel="noopener" href="https://www.cloudwego.io/zh/docs/hertz/overview/">https://www.cloudwego.io/zh/docs/hertz/overview/</a></p>
<p>Hertz是字节开发的HTTP框架，结合了其他开源框架的优点，同时满足字节跳动内部的需求，具有高可用性、高性能和高扩展性。</p>
<pre><code class="go">package main

import (
    &quot;context&quot;

    &quot;github.com/cloudwego/hertz/pkg/app&quot;
    &quot;github.com/cloudwego/hertz/pkg/app/server&quot;
    &quot;github.com/cloudwego/hertz/pkg/common/utils&quot;
    &quot;github.com/cloudwego/hertz/pkg/protocol/consts&quot;
)

func main() &#123;
    h := server.Default()

    h.GET(&quot;/ping&quot;, func(c context.Context, ctx *app.RequestContext) &#123;
            ctx.JSON(consts.StatusOK, utils.H&#123;&quot;message&quot;: &quot;pong&quot;&#125;)
    &#125;)

    h.Spin()
&#125;
</code></pre>
<p>高可用性：Hertz框架被设计为具有高度的稳定性和可用性，适用于大规模的应用场景。<br>高性能：框架在性能方面表现出色，适合处理高并发请求。<br>高扩展性：Hertz框架允许根据业务需求进行定制和扩展，以满足复杂应用的要求。</p>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2023/08/26/%E7%BD%91%E7%AB%99%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E%20%EF%BD%9C%20%E9%9D%92%E8%AE%AD%E8%90%A5%E7%AC%94%E8%AE%B0/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 24.305555555555554%;">
                    <img data-src="/images/background/xiaomai.jpg" data-sizes="auto" alt="网站安全漏洞 ｜ 青训营笔记" class="lazyload">
                    <h1>网站安全漏洞 ｜ 青训营笔记</h1>
                </div>
            
        </a>
        
        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2023年08月26日</a>
            <a><i class="nexmoefont icon-areachart"></i>2.1k 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 8 分钟</a>
        </div>
        
        <article>
            
                <h2 id="什么是漏洞"><a href="#什么是漏洞" class="headerlink" title="什么是漏洞"></a>什么是漏洞</h2><p>漏洞是指在网站或网络应用中存在的安全弱点，它们可能由于各种原因而产生，包括编码错误、配置不当或第三方组件的安全性不足。了解一个网站的基本构成是理解漏洞的第一步。网站通常由以下几个关键组成部分构成，而攻击者通常会尝试从这些部分找出弱点进行攻击：</p>
<ul>
<li><strong>前端</strong>：使用的技术可能包括HTML、CSS、JavaScript、Vue.js、React.js等。</li>
<li><strong>网关</strong>：例如nginx或Apache，负责处理进出的网络流量。</li>
<li><strong>后端</strong>：可能是用Go、Java、Node.js、Python等语言编写的。</li>
<li><strong>前后端交互</strong>：通常通过HTTP或WebSocket进行。</li>
</ul>
<h2 id="常见的安全事件"><a href="#常见的安全事件" class="headerlink" title="常见的安全事件"></a>常见的安全事件</h2><p>由安全漏洞引发的攻击事件不仅可能导致数据泄露、服务瘫痪、成果失窃和系统劫持，还可能带来以下更为严重的后果：</p>
<ul>
<li><strong>法律责任</strong>：泄露用户数据可能导致法律诉讼和巨额罚款。</li>
<li><strong>品牌声誉受损</strong>：一次严重的安全事件可能永久性地影响公司的声誉。</li>
<li><strong>业务中断</strong>：服务中断可能导致用户流失和收入减少。</li>
<li><strong>内外部信任度下降</strong>：员工和合作伙伴也可能因为安全事件而对企业失去信任。</li>
</ul>
<h2 id="网站攻击者的意图"><a href="#网站攻击者的意图" class="headerlink" title="网站攻击者的意图"></a>网站攻击者的意图</h2><p>确切地知道攻击者的意图可以帮助企业更有效地防御威胁。除了政治、经济和竞争等原因外，还有以下可能的攻击动机：</p>
<ul>
<li><strong>社会工程攻击</strong>：通过人为操作或欺骗，使内部人员泄露敏感信息。</li>
<li><strong>黑帽SEO</strong>：通过各种手段来操纵搜索引擎排名。</li>
<li><strong>资源占用</strong>：攻击者可能只是为了消耗目标网站的资源。</li>
<li><strong>纯粹的破坏欲</strong>：有些攻击者可能只是出于破坏的乐趣。</li>
</ul>
<h3 id="红蓝对抗"><a href="#红蓝对抗" class="headerlink" title="红蓝对抗"></a>红蓝对抗</h3><p>红蓝对抗是一种模拟现实世界网络攻防场景的方法，通常用于评估和提升组织的安全防护能力。在这一模式中，红军（Red Team）模拟攻击者，寻找系统的弱点和漏洞；蓝军（Blue Team）则扮演防御方，负责检测和阻止这些攻击。除此之外，还有所谓的“紫军”（Purple Team），负责协调红蓝两方，以确保双方都从对抗中获得最大的学习价值。</p>
<h3 id="攻击方式"><a href="#攻击方式" class="headerlink" title="攻击方式"></a>攻击方式</h3><p>网站攻击通常可以分为两大类：针对客户端的攻击和针对服务端的攻击。</p>
<ul>
<li><strong>针对客户端的攻击</strong>：这类攻击直接影响网站的终端用户，例如通过XSS（跨站脚本）或CSRF（跨站请求伪造）等方式。</li>
<li><strong>针对服务端的攻击</strong>：这类攻击目标是网站后端的服务器或数据库，例如通过SQL注入或命令执行等方式。 每一种攻击都有其自己的防护机制和修补方案，因此对这些攻击手段有深入的了解是非常重要的。</li>
</ul>
<h3 id="服务端漏洞"><a href="#服务端漏洞" class="headerlink" title="服务端漏洞"></a>服务端漏洞</h3><p>服务端漏洞通常比客户端漏洞更为严重，因为它们直接影响到整个系统的安全性。其中，第三方组件漏洞是一个常见但经常被忽视的问题。例如，一些流行的开源库或框架可能存在已知的安全问题，如果开发人员没有及时更新这些组件，就可能导致整个系统的安全性受到威胁。</p>
<h3 id="SQL注入漏洞"><a href="#SQL注入漏洞" class="headerlink" title="SQL注入漏洞"></a>SQL注入漏洞</h3><p>SQL注入是一种常见但危险的攻击手段，它出现在应用程序未能正确地处理用户输入的场合。更准确地说，攻击者通过输入特定的SQL代码片段，使得原SQL查询逻辑被改变，从而达到非法获取数据或执行特定操作的目的。防范SQL注入的基础是编码规范，包括但不限于使用预编译SQL语句、参数化查询，以及进行严格的输入验证。</p>
<h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><p>命令执行漏洞通常发生在应用需要与操作系统进行交互时。与SQL注入类似，这一漏洞也常常是由于不正确的输入处理引起的。攻击者可能会尝试插入恶意命令或参数，以此来控制或破坏目标系统。防护措施包括使用安全的API进行命令调用、对用户输入进行严格的验证和过滤，以及使用最小权限原则来限制应用程序对系统资源的访问。</p>
<h3 id="越权漏洞"><a href="#越权漏洞" class="headerlink" title="越权漏洞"></a>越权漏洞</h3><p>越权漏洞是授权控制不当导致的一类安全问题，它们通常分为三类：</p>
<ul>
<li><strong>未授权</strong>：用户无需任何授权即可访问受限制的资源。</li>
<li><strong>水平越权</strong>：用户访问同一权限级别但不属于自己的资源。</li>
<li><strong>垂直越权</strong>：低权限用户访问高权限用户的资源。 越权问题的根本在于不恰当的权限控制和会话管理，因此相应的防护措施应从这两方面入手。</li>
</ul>
<h3 id="SSRF攻击"><a href="#SSRF攻击" class="headerlink" title="SSRF攻击"></a>SSRF攻击</h3><p>服务端请求伪造（SSRF）是一种利用目标服务器作为中间人来发起请求的攻击。这样做可能会暴露原本不可达的内部网络资源。SSRF通常利用的是应用程序或服务器配置中的不当输入验证或URL解析缺陷。防范措施包括限制从服务器发出的请求类型和目标，以及对所有外部输入进行严格的验证。</p>
<h3 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h3><p>文件上传漏洞是一种常见的安全风险，尤其是在允许用户上传文件的应用中。如果没有适当的安全措施，攻击者可能会上传含有恶意代码的文件，这些文件一旦被执行，可能会导致严重的安全后果。因此，除了基本的文件类型检测和大小限制外，更高级的防护措施，如内容扫描和安全存储策略，也是非常必要的。</p>
<h3 id="客户端漏洞"><a href="#客户端漏洞" class="headerlink" title="客户端漏洞"></a>客户端漏洞</h3><p>客户端漏洞主要影响网站的最终用户，而不是服务器或数据库。这些漏洞通常涉及到如何处理从客户端（通常是Web浏览器）发来的数据和请求。例如，开放重定向是一种常见的客户端漏洞，攻击者通过这种漏洞可以将用户重定向到恶意网站。修复这类问题通常需要在客户端和服务器端都进行适当的输入验证。</p>
<h3 id="跨站脚本（XSS）攻击"><a href="#跨站脚本（XSS）攻击" class="headerlink" title="跨站脚本（XSS）攻击"></a>跨站脚本（XSS）攻击</h3><p>跨站脚本（XSS）是一种在目标网站上执行恶意脚本的攻击方式。它利用的是网站没有对用户提交的数据进行适当的过滤和转义。根据攻击的具体形式，XSS攻击可以进一步分为存储型、反射型和DOM型三类。每种类型的XSS攻击都有其独特的防御方法，如输入过滤、输出编码和内容安全策略（CSP）。</p>
<h3 id="跨站请求伪造（CSRF）"><a href="#跨站请求伪造（CSRF）" class="headerlink" title="跨站请求伪造（CSRF）"></a>跨站请求伪造（CSRF）</h3><p>跨站请求伪造（CSRF）是一种攻击手法，攻击者通过某种方式诱导用户点击一个链接或按钮，从而在用户不知情的情况下，以该用户的身份执行非预期的操作。防御CSRF攻击的常见方法包括使用CSRF令牌、设置SameSite属性等。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在这篇文章中，我们列举了网站安全漏洞的多个方面，从基础概念到各种类型的安全漏洞，以及如何防范这些漏洞。重要的是，无论是服务端还是客户端，安全漏洞都可能存在，并且都需要得到妥善的处理。</p>
<p>网站安全是一个涉及多个层面的复杂问题，需要开发者、运维人员、以及安全团队共同努力来维护。只有全方位、多层次的安全防护措施，才能有效地减少安全风险，保护网站和用户数据的安全。</p>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2023/08/24/go%E6%9E%B6%E6%9E%84%20%EF%BD%9C%20%E9%9D%92%E8%AE%AD%E8%90%A5%E7%AC%94%E8%AE%B0/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 24.305555555555554%;">
                    <img data-src="/images/background/xiaomai.jpg" data-sizes="auto" alt="go架构 ｜ 青训营笔记" class="lazyload">
                    <h1>go架构 ｜ 青训营笔记</h1>
                </div>
            
        </a>
        
        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2023年08月24日</a>
            <a><i class="nexmoefont icon-areachart"></i>3.3k 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 14 分钟</a>
        </div>
        
        <article>
            
                <h2 id="什么是架构"><a href="#什么是架构" class="headerlink" title="什么是架构"></a>什么是架构</h2><p>主要针对互联网服server系统（类似网站）来定义架构：架构是系统的骨架，支撑和链接各个部分，包括组件、连接件、约束规范，以及指导这些内容设计与演化的原理。</p>
<ul>
<li><p>组件：类似应用服务，独立模块、数据库、nginx等等、</p>
</li>
<li><p>连接件：分布式调用、进程间调用、调用使用http协议还是tcp协议、组件之间的交互关系、</p>
</li>
<li><p>约束规范： 定规则做限制：例如设计原则、编码规范等等。</p>
</li>
</ul>
<h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><p>组件是架构的构建块，包括独立模块、数据库、Nginx等。</p>
<p>例如，Go语言中可以定义一个组件，如一个HTTP服务器：</p>
<pre><code class="go">package main

import (
    &quot;net/http&quot;
)

func main() &#123;
    http.HandleFunc(&quot;/&quot;, func(w http.ResponseWriter, r *http.Request) &#123;
        w.Write([]byte(&quot;Hello, World!&quot;))
    &#125;)
    http.ListenAndServe(&quot;:8080&quot;, nil)
&#125;
</code></pre>
<h3 id="连接件"><a href="#连接件" class="headerlink" title="连接件"></a>连接件</h3><p>连接件处理组件之间的交互关系，例如分布式调用、进程间调用、使用的协议等。</p>
<h3 id="约束规范"><a href="#约束规范" class="headerlink" title="约束规范"></a>约束规范</h3><p>约束规范定义了架构中的规则和限制，例如设计原则和编码规范。</p>
<h2 id="几种典型架构"><a href="#几种典型架构" class="headerlink" title="几种典型架构"></a>几种典型架构</h2><h3 id="单机架构"><a href="#单机架构" class="headerlink" title="单机架构"></a>单机架构</h3><p>单机架构就是把所有功能都实现在一个进程中，并部署在一台机器上。</p>
<p>单机架构的<strong>优点</strong>是非常简单，<strong>缺点</strong>是会遇到并发处理的难题，而且运维需要停服。</p>
<p>当时计算机软硬件性能比较基础，这个问题引起人们对网络套接字优化和服务端调度的关注，这个词语也随着时代的发展逐渐变化，如<code>C10M</code>代表的是处理1000万个并发连接。现在的计算机已经有足够的性能和优秀的软件来支撑单机数百万连接了，然而并发问题仍然是后端架构设计中不能略过的关键问题。</p>
<h3 id="单体架构"><a href="#单体架构" class="headerlink" title="单体架构"></a>单体架构</h3><p>单体架构是对单机架构的改进。既然单机处理能力有限，就可以采用分布式部署的模式设置多台单机，再设置一个分流环节，将请求转发给各个单体服务器来处理。</p>
<p>单体架构的优点是可以实现水平扩容，处理能力不够时只需要简单添加新的单机即可；运维不需要停服，可以逐个对单机维护不影响其他单机的运行。单体架构下，每台机器的功能是一致的，因此它没有解决这两个缺点：</p>
<ol>
<li>职责太多，开发效率低：每台机器都要实现系统的完整功能，不能专注于某个功能的开发。</li>
<li><strong>爆炸半径大</strong>： 爆炸半径是指爆炸可能造成损害的区域范围。在生产环境中指的就是部署的服务故障时可能影响的软件功能范围。单体架构下每一个单机下线，都会造成所有功能的处理承载量下降，因此爆炸半径覆盖了软件多数功能。</li>
</ol>
<h3 id="垂直应用架构"><a href="#垂直应用架构" class="headerlink" title="垂直应用架构"></a>垂直应用架构</h3><p>为了解决单体架构的问题，垂直应用架构提供了一种思路，将系统按照服务拆分任务，分配给不同的服务器，从而实现职责的简单划分，一定程度上提高开发和运维的效率。不过在实践中一个服务往往是大量功能点的集合，仍然存在功能琐碎的问题</p>
<h2 id="更加高级的架构"><a href="#更加高级的架构" class="headerlink" title="更加高级的架构"></a>更加高级的架构</h2><h3 id="SOA、微服务架构"><a href="#SOA、微服务架构" class="headerlink" title="SOA、微服务架构"></a>SOA、微服务架构</h3><p>SOA（Service-Oriented Architecture）架构具有两个特性：</p>
<ol>
<li>将应用的不同功能单元抽象为服务，从而细分职责</li>
<li>定义服务之间的通信标准，确保服务之间的数据流通</li>
</ol>
<p>微服务架构则是SOA架构去中心化的演进方向，旨在减少服务之间的沟通消耗，避免SOA服务内部集中沟通导致的过度中心化问题，他实现了水平切分，减少了跨级别调用链，让每个服务直接负责的上下级减少。</p>
<p>这类架构在解决之前的弊端时，也会引入新的问题：</p>
<ul>
<li>数据一致性问题：不同服务如何确保数据同步</li>
<li>高可用问题：服务之间如何进行可靠合作</li>
<li>治理问题：一个服务出现问题时，要如何容灾</li>
<li>解耦和过微问题：过度细分会导致运维成本提高，要如何权衡？</li>
</ul>
<h3 id="事件驱动架构"><a href="#事件驱动架构" class="headerlink" title="事件驱动架构"></a>事件驱动架构</h3><p>事件驱动架构（EDA）是一种异步架构，其中生产者生成事件，并由一个或多个消费者消费。这允许解耦生产者和消费者，并实现高度可扩展和灵活的系统。</p>
<p>Apache Kafka<br>Apache Kafka是一种流行的事件流平台。您可以使用Go编写Kafka的生产者和消费者。</p>
<p>如下是示例代码 </p>
<pre><code class="go">package main

import (
    &quot;github.com/confluentinc/confluent-kafka-go/kafka&quot;
)

func main() &#123;
    producer, err := kafka.NewProducer(&amp;kafka.ConfigMap&#123;&quot;bootstrap.servers&quot;: &quot;localhost&quot;&#125;)
    if err != nil &#123;
        panic(err)
    &#125;

    // 生产消息
    producer.Produce(&amp;kafka.Message&#123;
        TopicPartition: kafka.TopicPartition&#123;Topic: &amp;topic, Partition: kafka.PartitionAny&#125;,
        Value:          []byte(&quot;Message Value&quot;),
    &#125;, nil)

    // 消费消息
    consumer, err := kafka.NewConsumer(&amp;kafka.ConfigMap&#123;
        &quot;bootstrap.servers&quot;: &quot;localhost&quot;,
        &quot;group.id&quot;:          &quot;myGroup&quot;,
        &quot;auto.offset.reset&quot;: &quot;earliest&quot;,
    &#125;)
    consumer.SubscribeTopics([]string&#123;&quot;myTopic&quot;&#125;, nil)
    msg, err := consumer.ReadMessage(-1)
    if err == nil &#123;
        fmt.Printf(&quot;Message on %s: %s\n&quot;, msg.TopicPartition, string(msg.Value))
    &#125;
&#125;
</code></pre>
<h3 id="云计算"><a href="#云计算" class="headerlink" title="云计算"></a>云计算</h3><p>云计算是指通过软件自动化管理，提供计算资源的服务网络，是现在互联网大规模数据分析和存储的基石。</p>
<p>云计算的基础是虚拟化技术和编排方式，关系到资源的分配和调度。</p>
<p>云计算提供一系列特有的架构：</p>
<ul>
<li>基础设施即服务IaaS（Infrastructure as a Service）：服务商提供互联网基础设施，比如用户只需要获得服务器、云硬盘、宽带网络，而不用关心物理的机房、数据中心、网络怎么建设。但是，用户需要自己进行服务器系统安装、环境部署和软件配置。</li>
<li>平台即服务PaaS（Platform as a Service）：服务商提供底层软件设施，比如为用户准备安装了指定操作系统、数据库软件、环境套件的主机。用户需要自己控制上层应用的部署和托管。</li>
<li>软件即服务Saas（Software as a Service）：服务商及提供基于软件的解决方案来满足客户的需求，比如用户想要一套OA办公系统，CMS内容管理系统，HRM人事管理系统等，而不用自行搭建和维护这样的服务，能够简化用户的工作。</li>
<li>函数即服务FaaS（Function as a service）：服务商提供一个平台，允许客户开发、运行和管理应用程序功能，而不用关心如何启动和部署这样的程序。这个模式是“无服务器”体系架构的方式，具有灵活性，适合构建微服务应用程序。</li>
</ul>
<h3 id="云原生架构"><a href="#云原生架构" class="headerlink" title="云原生架构"></a>云原生架构</h3><p>云原生技术为公司在公有云、私有云、混合云等新型动态环境中，构建和运行可弹性拓展的应用提供了可能。</p>
<p>云原生为公司提供了以下关键能力：</p>
<h3 id="弹性资源调度"><a href="#弹性资源调度" class="headerlink" title="弹性资源调度"></a>弹性资源调度</h3><ul>
<li>服务资源调度：分配微服务、大服务使用的资源。</li>
<li>计算资源调度：分配在线计算、离线计算使用的资源</li>
<li>消息队列：和计算资源调度类似，提供海量的数据吞吐和大数据分析能力。</li>
</ul>
<h3 id="弹性存储资源"><a href="#弹性存储资源" class="headerlink" title="弹性存储资源"></a>弹性存储资源</h3><p>云原生让用户可以将存储资源看作服务，寻找对应的服务来满足自己的存储需求。</p>
<ul>
<li>经典存储：对象存储、大数据记录存储。</li>
<li>关系型数据库：业务记录存储。</li>
<li>元数据：提供服务发现能力</li>
<li>NoSQL：key-value存储，实现缓存和分布式事务。</li>
</ul>
<h3 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h3><p>DevOps贯穿整个软件开发周期，使用一系列自动化流程，提高软件开发、交付的效率。DevOps提供了敏捷开发、持续集成&#x2F;交付（CI&#x2F;CD）的能力。</p>
<h3 id="微服务架构"><a href="#微服务架构" class="headerlink" title="微服务架构"></a>微服务架构</h3><p>微服务架构实现业务功能单元的解耦，同时提供一套统一的通信标准确保服务之间的数据流通。</p>
<p>微服务常见的通信标准是HTTP（RESTful API）和RPC（Thrift, gRPC），需要结合性能、服务治理、协议可解释性来选择。实际场景下，常常使用微服务框架提供的通信能力，而不用自己从头实现一套。</p>
<h3 id="服务网格"><a href="#服务网格" class="headerlink" title="服务网格"></a>服务网格</h3><p>服务网格实现业务与治理的结构以及异构系统治理的统一化，从而提供复杂的治理能力。</p>
<h3 id="服务发现"><a href="#服务发现" class="headerlink" title="服务发现"></a>服务发现</h3><p>服务注册与发现 Eureka或Consul等服务可以用于服务发现。</p>
<p>服务注册与发现使服务可以动态地找到其他服务的位置。</p>
<pre><code class="go">// 使用Consul进行服务注册
consulConfig := consulapi.DefaultConfig()
consulConfig.Address = &quot;localhost:8500&quot;
client, err := consulapi.NewClient(consulConfig)
if err != nil &#123;
    log.Fatal(err)
&#125;

// 创建新的服务
registration := new(consulapi.AgentServiceRegistration)
registration.ID = &quot;my-service-id&quot;
registration.Name = &quot;my-service&quot;
registration.Port = 8080
registration.Tags = []string&#123;&quot;my-service&quot;&#125;

// 注册服务
agent := client.Agent()
if err := agent.ServiceRegister(registration); err != nil &#123;
    log.Fatal(err)
&#125;

// 服务发现逻辑...
</code></pre>
<h3 id="分布式架构"><a href="#分布式架构" class="headerlink" title="分布式架构"></a>分布式架构</h3><p>分布式锁</p>
<p>在分布式环境中，协调多个节点的访问资源可能会变得复杂。分布式锁是一种解决方案，可以在多个节点之间同步访问。</p>
<p>可以使用Go语言和Redis创建分布式锁：</p>
<pre><code class="go">
package main

import (
    &quot;fmt&quot;
    &quot;github.com/go-redis/redis/v8&quot;
    &quot;golang.org/x/net/context&quot;
)

func main() &#123;
    rdb := redis.NewClient(&amp;redis.Options&#123;
        Addr: &quot;localhost:6379&quot;,
    &#125;)

    ctx := context.Background()
    lockKey := &quot;lock_key&quot;

    // 尝试获取锁
    locked, err := rdb.SetNX(ctx, lockKey, &quot;lock_value&quot;, 0).Result()
    if err != nil || !locked &#123;
        fmt.Println(&quot;获取锁失败&quot;)
        return
    &#125;

    // 执行业务逻辑...

    // 释放锁
    rdb.Del(ctx, lockKey)
    fmt.Println(&quot;业务逻辑执行完毕，锁已释放&quot;)
&#125;
</code></pre>
<h2 id="优化方式"><a href="#优化方式" class="headerlink" title="优化方式"></a>优化方式</h2><h3 id="离在线资源并池"><a href="#离在线资源并池" class="headerlink" title="离在线资源并池"></a>离在线资源并池</h3><p>在线业务以<strong>IO密集型</strong>为主，要求计算的<strong>实时性</strong>，但是具有<strong>潮汐性</strong>，不同时间段的压力不同。离线业务以<strong>计算密集型</strong>为主，对计算实时性不高。</p>
<p>把在线和离线资源放入同一个资源池进行调度，利用在线业务的潮汐性自动扩缩容，能够有效降低物理资源成本，提供更多的弹性资源，增加收益。</p>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p>简单的http负载均衡 轮询算法</p>
<pre><code class="go">package main

import (
    &quot;net/http&quot;
    &quot;net/http/httputil&quot;
    &quot;net/url&quot;
)

var servers = []string&#123;
    &quot;http://localhost:8081&quot;,
    &quot;http://localhost:8082&quot;,
&#125;

var currentServer = 0

func nextServer() string &#123;
    server := servers[currentServer]
    currentServer = (currentServer + 1) % len(servers)
    return server
&#125;

func main() &#123;
    http.HandleFunc(&quot;/&quot;, func(w http.ResponseWriter, r *http.Request) &#123;
        server := nextServer()
        target, _ := url.Parse(server)
        proxy := httputil.NewSingleHostReverseProxy(target)
        proxy.ServeHTTP(w, r)
    &#125;)
    http.ListenAndServe(&quot;:8080&quot;, nil)
&#125;
</code></pre>
<h3 id="亲和性部署"><a href="#亲和性部署" class="headerlink" title="亲和性部署"></a>亲和性部署</h3><p>如果两个微服务之间通信密切，则这两个服务的亲和性较高。将满足亲和性条件的容器调度到一台宿主机，让微服务中间件与服务网格通过共享内存通信，能够有效降低通信成本，提高服务可用性。</p>
<h3 id="流量治理"><a href="#流量治理" class="headerlink" title="流量治理"></a>流量治理</h3><p>基于微服务中间件和服务网格的流量治理，赋予微服务熔断、重试的能力，提供复杂环境下的流量调度，可以提高微服务调用容错性，增强容灾能力，还能进一步提高开发效率。</p>
<h3 id="CPU水位负载均衡"><a href="#CPU水位负载均衡" class="headerlink" title="CPU水位负载均衡"></a>CPU水位负载均衡</h3><p>结合IaaS提供的资源探针和服务网格的负载均衡能力，能够为自动扩缩容提供反馈，打平异构环境下算力的差异。</p>
<h3 id="容器化与服务编排"><a href="#容器化与服务编排" class="headerlink" title="容器化与服务编排"></a>容器化与服务编排</h3><p>Docker</p>
<p>可以使用Docker将Go应用程序打包到容器中，并确保它在任何支持Docker的平台上以相同的方式运行。</p>
<p>Kubernetes</p>
<p>Kubernetes是一种强大的容器编排工具，用于自动部署、扩展和管理容器化应用程序。Go语言是Kubernetes的主要实现语言。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>现代软件架构的复杂性和灵活性要求了解许多概念和技术。从单机到分布式，从单体到微服务，架构演化为满足不断增长的需求。</p>
<p>通过使用强大和灵活的编程语言，如Go，您可以构建符合这些需求的解决方案。从分布式锁到服务发现，从负载均衡到微服务通信，Go为构建现代、可扩展和高性能的系统提供了强大的工具和库。</p>
<p>不断学习和实践这些概念和技术将使您更好地设计和构建复杂的系统，满足业务目标，并应对未来的挑战。</p>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2023/08/23/gorm%E5%88%9D%E4%BD%93%E9%AA%8C%20%EF%BD%9C%20%E9%9D%92%E8%AE%AD%E8%90%A5%E7%AC%94%E8%AE%B0/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 24.305555555555554%;">
                    <img data-src="/images/background/xiaomai.jpg" data-sizes="auto" alt="gorm 初体验 ｜ 青训营笔记" class="lazyload">
                    <h1>gorm 初体验 ｜ 青训营笔记</h1>
                </div>
            
        </a>
        
        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2023年08月23日</a>
            <a><i class="nexmoefont icon-areachart"></i>2.3k 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 11 分钟</a>
        </div>
        
        <article>
            
                <h2 id="gorm"><a href="#gorm" class="headerlink" title="gorm"></a>gorm</h2><p><img src="https://gorm.io/gorm.svg"></p>
<p>gorm是Golang语言中一款性能极好的ORM库，对开发人员相对是比较友好的。接下来主要学习下gorm库的一些基本使用。</p>
<p>功能概览</p>
<ul>
<li>全功能 ORM</li>
<li>关联 (Has One，Has Many，Belongs To，Many To Many，多态，单表继承)</li>
<li>Create，Save，Update，Delete，Find 中钩子方法</li>
<li>支持 Preload、Joins 的预加载</li>
<li>事务，嵌套事务，Save Point，Rollback To Saved Point</li>
<li>Context、预编译模式、DryRun 模式</li>
<li>批量插入，FindInBatches，Find&#x2F;Create with Map，使用 SQL 表达式、Context Valuer 进行 CRUD</li>
<li>SQL 构建器，Upsert，数据库锁，Optimizer&#x2F;Index&#x2F;Comment Hint，命名参数，子查询<br>复合主键，索引，约束</li>
<li>Auto Migration</li>
<li>自定义 Logger</li>
<li>灵活的可扩展插件 API：Database Resolver（多数据库，读写分离）、Prometheus…</li>
<li>每个特性都经过了测试的重重考验</li>
<li>开发者友好</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>安装</p>
<pre><code class="bash">go get -u gorm.io/gorm
go get -u gorm.io/driver/sqlite
</code></pre>
<h3 id="模型定义"><a href="#模型定义" class="headerlink" title="模型定义"></a>模型定义</h3><h4 id="基本定义"><a href="#基本定义" class="headerlink" title="基本定义"></a>基本定义</h4><p>因为orm可以自动创建数据库，创建表，所以我们要用一个约定的形式来描述一个schema，便于他创建表，也便于代码中调用</p>
<p>例如</p>
<pre><code class="go">type User struct &#123;
  Name         string
  Email        string
  Age          uint8
&#125;
</code></pre>
<p>这样的一个结构体就可以描述user这个表</p>
<h4 id="gorm-Model"><a href="#gorm-Model" class="headerlink" title="gorm.Model"></a>gorm.Model</h4><pre><code class="go">// gorm.Model 的定义
type Model struct &#123;
  ID        uint           `gorm:&quot;primaryKey&quot;`
  CreatedAt time.Time
  UpdatedAt time.Time
  DeletedAt gorm.DeletedAt `gorm:&quot;index&quot;`
&#125;
</code></pre>
<p>这个约定了一些gorm的标准配置，相当于implement了这个结构体</p>
<p>例如</p>
<pre><code class="go">type User struct &#123;
  gorm.Model
  Name         string
  Email        string
  Age          uint8
&#125;
</code></pre>
<p>这样这个gorm.Model相当于在user表里添加了一些基础的字段</p>
<p>这个user最终会变成 相当于</p>
<pre><code class="go">type User struct &#123;
  ID        uint           `gorm:&quot;primaryKey&quot;`
  CreatedAt time.Time
  UpdatedAt time.Time
  DeletedAt gorm.DeletedAt `gorm:&quot;index&quot;`
  Name         string
  Email        string
  Age          uint8
&#125;
</code></pre>
<h4 id="嵌入结构体"><a href="#嵌入结构体" class="headerlink" title="嵌入结构体"></a>嵌入结构体</h4><p>如上的gorm.Model就是一种嵌入结构体</p>
<p>官网的解释是：对于匿名字段，GORM 会将其字段包含在父结构体中</p>
<p>其他嵌入方法为：</p>
<p>对于正常的结构体字段，你也可以通过标签 embedded 将其嵌入，例如：</p>
<pre><code class="go">type Author struct &#123;
    Name  string
    Email string
&#125;

type Blog struct &#123;
  ID      int
  Author  Author `gorm:&quot;embedded&quot;`
  Upvotes int32
&#125;
</code></pre>
<pre><code class="go">// 它等效于
type Blog struct &#123;
  ID    int64
  Name  string
  Email string
  Upvotes  int32
&#125;
</code></pre>
<blockquote>
<p>可以使用标签 embeddedPrefix 来为 db 中的字段名添加前缀<br>Author  Author &#96;gorm:”embedded;embeddedPrefix:author_”</p>
</blockquote>
<h4 id="字段标签"><a href="#字段标签" class="headerlink" title="字段标签"></a>字段标签</h4><p>声明 model 时，tag 是可选的，gorm 支持以下这些 tag： tag 名大小写不敏感，但我们写的时候最好用驼峰命名法。</p>
<p>写法为 在字段后面添加飘号和gorm:</p>
<p>例如</p>
<pre>
ID        uint           `gorm:"primaryKey"`
</pre>

<table>
<thead>
<tr>
<th align="left">标签名</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">column</td>
<td align="left">指定 database 的列名</td>
</tr>
<tr>
<td align="left">type</td>
<td align="left">列数据类型，推荐使用兼容性好的通用类型，例如：所有数据库都支持 bool、int、uint、float、string、time、bytes 并且可以和其他标签一起使用，例如：<code>not null</code>、<code>size</code>, <code>autoIncrement</code>… 像 <code>varbinary(8)</code> 这样指定数据库数据类型也是支持的。在使用指定数据库数据类型时，它需要是完整的数据库数据类型，如：<code>MEDIUMINT UNSIGNED not NULL AUTO_INCREMENT</code></td>
</tr>
<tr>
<td align="left">serializer</td>
<td align="left">指定将数据序列化或反序列化到数据库中的序列化器, 例如: <code>serializer:json/gob/unixtime</code></td>
</tr>
<tr>
<td align="left">size</td>
<td align="left">定义列数据类型的大小或长度，例如 <code>size: 256</code></td>
</tr>
<tr>
<td align="left">primaryKey</td>
<td align="left">将列定义为主键</td>
</tr>
<tr>
<td align="left">unique</td>
<td align="left">将列定义为唯一键</td>
</tr>
<tr>
<td align="left">default</td>
<td align="left">定义列的默认值</td>
</tr>
<tr>
<td align="left">precision</td>
<td align="left">指定列的精度</td>
</tr>
<tr>
<td align="left">scale</td>
<td align="left">指定列大小</td>
</tr>
<tr>
<td align="left">not null</td>
<td align="left">指定列为 NOT NULL</td>
</tr>
<tr>
<td align="left">autoIncrement</td>
<td align="left">指定列为自动增长</td>
</tr>
<tr>
<td align="left">autoIncrementIncrement</td>
<td align="left">自动步长，控制连续记录之间的间隔</td>
</tr>
<tr>
<td align="left">embedded</td>
<td align="left">嵌套字段</td>
</tr>
<tr>
<td align="left">embeddedPrefix</td>
<td align="left">嵌入字段的列名前缀</td>
</tr>
<tr>
<td align="left">autoCreateTime</td>
<td align="left">创建时追踪当前时间，对于 <code>int</code> 字段，它会追踪时间戳秒数，您可以使用 <code>nano</code>&#x2F;<code>milli</code> 来追踪纳秒、毫秒时间戳，例如：<code>autoCreateTime:nano</code></td>
</tr>
<tr>
<td align="left">autoUpdateTime</td>
<td align="left">创建&#x2F;更新时追踪当前时间，对于 <code>int</code> 字段，它会追踪时间戳秒数，您可以使用 <code>nano</code>&#x2F;<code>milli</code> 来追踪纳秒、毫秒时间戳，例如：<code>autoUpdateTime:milli</code></td>
</tr>
<tr>
<td align="left">index</td>
<td align="left">根据参数创建索引，多个字段使用相同的名称则创建复合索引，查看 <a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/indexes.html">索引</a> 获取详情</td>
</tr>
<tr>
<td align="left">uniqueIndex</td>
<td align="left">与 <code>index</code> 相同，但创建的是唯一索引</td>
</tr>
<tr>
<td align="left">check</td>
<td align="left">创建检查约束，例如 <code>check:age &gt; 13</code>，查看 <a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/constraints.html">约束</a> 获取详情</td>
</tr>
<tr>
<td align="left">&lt;-</td>
<td align="left">设置字段写入的权限， <code>&lt;-:create</code> 只创建、<code>&lt;-:update</code> 只更新、<code>&lt;-:false</code> 无写入权限、<code>&lt;-</code> 创建和更新权限</td>
</tr>
<tr>
<td align="left">-&gt;</td>
<td align="left">设置字段读的权限，<code>-&gt;:false</code> 无读权限</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">忽略该字段，<code>-</code> 表示无读写，<code>-:migration</code> 表示无迁移权限，<code>-:all</code> 表示无读写迁移权限</td>
</tr>
<tr>
<td align="left">comment</td>
<td align="left">迁移时为字段添加注释</td>
</tr>
</tbody></table>
<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p>官方提供的代码</p>
<pre><code class="go">import (
  &quot;gorm.io/driver/mysql&quot;
  &quot;gorm.io/gorm&quot;
)

func main() &#123;
  // 参考 https://github.com/go-sql-driver/mysql#dsn-data-source-name 获取详情
  dsn := &quot;user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;
  db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)
&#125;
</code></pre>
<p>这里我提供一种封装方案，因为一般数据库配置写在配置文件里，防止泄露与主代码分离‘</p>
<pre><code class="go">
import (
    &quot;fmt&quot;
    &quot;gorm.io/driver/mysql&quot;
    &quot;gorm.io/gorm&quot;
    &quot;gorm.io/gorm/schema&quot;
)

type Config struct &#123;
    // 数据库配置
    DBList DBListConf
&#125;

type DBListConf struct &#123;
    Mysql MysqlConf
&#125;

type MysqlConf struct &#123;
    Address     string
    Username    string
    Password    string
    DBName      string
    TablePrefix string
&#125;

type ServiceContext struct &#123;
    Config Config
    DBList *DBList
&#125;

type DBList struct &#123;
    Mysql *gorm.DB
&#125;

func NewServiceContext(c Config) *ServiceContext &#123;
    return &amp;ServiceContext&#123;
        Config: c,
        DBList: initDB(c),
    &#125;
&#125;

func initDB(c Config) *DBList &#123;
    dbList := new(DBList)
    dbList.Mysql = initMysql(c)

    return dbList
&#125;

func initMysql(c Config) *gorm.DB &#123;
    dsn := fmt.Sprintf(&quot;%s:%s@tcp(%s)/%s?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;,
        c.DBList.Mysql.Username,
        c.DBList.Mysql.Password,
        c.DBList.Mysql.Address,
        c.DBList.Mysql.DBName,
    )

    db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;
        NamingStrategy: schema.NamingStrategy&#123;
            TablePrefix:   c.DBList.Mysql.TablePrefix, // 表名前缀
            SingularTable: true,                       // 使用单数表名
        &#125;,
        DisableForeignKeyConstraintWhenMigrating: true,
    &#125;)
    if err != nil &#123;
        panic(err)
    &#125;

    // 自动建表
    err = db.AutoMigrate(&amp;model.Video&#123;&#125;, &amp;model.Favorite&#123;&#125;, &amp;model.Comment&#123;&#125;)
    if err != nil &#123;
        panic(err)
    &#125;

    return db
&#125;

func main() &#123;
    // 创建配置实例
    config := Config&#123;
        DBList: DBListConf&#123;
            Mysql: MysqlConf&#123;
                Address:     &quot;Address&quot;,
                Username:    &quot;root&quot;,
                Password:    &quot;1111111111111&quot;,
                DBName:      &quot;dbname&quot;,
                TablePrefix: &quot;Prefix&quot;,
            &#125;,
        &#125;,
    &#125;

    // 创建服务上下文
    serviceContext := NewServiceContext(config)
    
    // 在这里你可以使用 serviceContext 进行操作
    // ...

    fmt.Println(&quot;Database initialization and configuration completed.&quot;)
&#125;

</code></pre>
<p>这里出现了自动建表的操作AutoMigrate 你需要把你想要创建的模型传进来自动建表</p>
<h2 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h2><h3 id="1-C"><a href="#1-C" class="headerlink" title="1. C"></a>1. C</h3><p>接下来开始 crud,</p>
<p>假如你有一个user表，可以使用create创建多个数据</p>
<pre><code class="go">users := []*User&#123;
    User&#123;Name: &quot;Jinzhu&quot;, Age: 18, Birthday: time.Now()&#125;,
    User&#123;Name: &quot;Jackson&quot;, Age: 19, Birthday: time.Now()&#125;,
&#125;

result := db.Create(users) // pass a slice to insert multiple row

result.Error        // returns error
result.RowsAffected // returns inserted records count
</code></pre>
<p>Error相信你会接</p>
<pre><code class="go">if result.Error != nil &#123;
    return exit
&#125;
</code></pre>
<p>或者可以直接在create里</p>
<pre><code class="go">err := db.create().Error
if err != nil &#123;
    return exit
&#125;
</code></pre>
<h3 id="2-R"><a href="#2-R" class="headerlink" title="2.R"></a>2.R</h3><p>根据主键检索</p>
<pre><code class="go">
db.First(&amp;user, 10)
// SELECT * FROM users WHERE id = 10;

db.First(&amp;user, &quot;10&quot;)
// SELECT * FROM users WHERE id = 10;

db.Find(&amp;users, []int&#123;1,2,3&#125;)
// SELECT * FROM users WHERE id IN (1,2,3);
</code></pre>
<p>这里的first为检索第一个 limit为1</p>
<p>检索全部对象</p>
<pre><code class="go">// Get all records
result := db.Find(&amp;users)
// SELECT * FROM users;

result.RowsAffected // returns found records count, equals `len(users)`
result.Error        // returns error
</code></pre>
<p>条件检索</p>
<p>这样相当于拼sql语句</p>
<pre><code class="go">// Get first matched record
db.Where(&quot;name = ?&quot;, &quot;jinzhu&quot;).First(&amp;user)
// SELECT * FROM users WHERE name = &#39;jinzhu&#39; ORDER BY id LIMIT 1;

// Get all matched records
db.Where(&quot;name &lt;&gt; ?&quot;, &quot;jinzhu&quot;).Find(&amp;users)
// SELECT * FROM users WHERE name &lt;&gt; &#39;jinzhu&#39;;

// IN
db.Where(&quot;name IN ?&quot;, []string&#123;&quot;jinzhu&quot;, &quot;jinzhu 2&quot;&#125;).Find(&amp;users)
// SELECT * FROM users WHERE name IN (&#39;jinzhu&#39;,&#39;jinzhu 2&#39;);

// LIKE
db.Where(&quot;name LIKE ?&quot;, &quot;%jin%&quot;).Find(&amp;users)
// SELECT * FROM users WHERE name LIKE &#39;%jin%&#39;;

// AND
db.Where(&quot;name = ? AND age &gt;= ?&quot;, &quot;jinzhu&quot;, &quot;22&quot;).Find(&amp;users)
// SELECT * FROM users WHERE name = &#39;jinzhu&#39; AND age &gt;= 22;

// Time
db.Where(&quot;updated_at &gt; ?&quot;, lastWeek).Find(&amp;users)
// SELECT * FROM users WHERE updated_at &gt; &#39;2000-01-01 00:00:00&#39;;

// BETWEEN
db.Where(&quot;created_at BETWEEN ? AND ?&quot;, lastWeek, today).Find(&amp;users)
// SELECT * FROM users WHERE created_at BETWEEN &#39;2000-01-01 00:00:00&#39; AND &#39;2000-01-08 00:00:00&#39;;
</code></pre>
<p>高级查询 <a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/advanced_query.html">https://gorm.io/zh_CN/docs/advanced_query.html</a></p>
<h3 id="3-U"><a href="#3-U" class="headerlink" title="3.U"></a>3.U</h3><p>更新 所有字段</p>
<pre><code class="go">db.Save(&amp;User&#123;Name: &quot;jinzhu&quot;, Age: 100&#125;)
// INSERT INTO `users` (`name`,`age`,`birthday`,`update_at`) VALUES (&quot;jinzhu&quot;,100,&quot;0000-00-00 00:00:00&quot;,&quot;0000-00-00 00:00:00&quot;)

db.Save(&amp;User&#123;ID: 1, Name: &quot;jinzhu&quot;, Age: 100&#125;)
// UPDATE `users` SET `name`=&quot;jinzhu&quot;,`age`=100,`birthday`=&quot;0000-00-00 00:00:00&quot;,`update_at`=&quot;0000-00-00 00:00:00&quot; WHERE `id` = 1
</code></pre>
<p>更多更新方法 <a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/update.html">https://gorm.io/zh_CN/docs/update.html</a></p>
<h3 id="4-D"><a href="#4-D" class="headerlink" title="4.D"></a>4.D</h3><p>删除一条记录 </p>
<pre><code class="go">// Email 的 ID 是 `10`
db.Delete(&amp;email)
// DELETE from emails where id = 10;

// 带额外条件的删除
db.Where(&quot;name = ?&quot;, &quot;jinzhu&quot;).Delete(&amp;email)
// DELETE from emails where id = 10 AND name = &quot;jinzhu&quot;;
</code></pre>
<p>更多删除方法 <a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/delete.html">https://gorm.io/zh_CN/docs/delete.html</a></p>
<p>其中的软删除感觉很有用</p>
<blockquote>
<p>当调用Delete时，GORM并不会从数据库中删除该记录，而是将该记录的DeleteAt设置为当前时间，而后的一般查询方法将无法查找到此条记录。</p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>gorm是个很好用的go的orm框架，对很多数据库都兼容</p>
<p>性能也很好，操作起来也很简单。</p>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2023/07/25/go%E8%AF%AD%E8%A8%80%E4%B8%89%E4%B8%AA%E5%B0%8F%E9%A1%B9%E7%9B%AE%20%EF%BD%9C%20%E9%9D%92%E8%AE%AD%E8%90%A5%E7%AC%94%E8%AE%B0/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 24.305555555555554%;">
                    <img data-src="/images/background/xiaomai.jpg" data-sizes="auto" alt="go语言三个小项目 ｜ 青训营笔记" class="lazyload">
                    <h1>go语言三个小项目 ｜ 青训营笔记</h1>
                </div>
            
        </a>
        
        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2023年07月25日</a>
            <a><i class="nexmoefont icon-areachart"></i>1.4k 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 6 分钟</a>
        </div>
        
        <article>
            
                <h2 id="猜数字"><a href="#猜数字" class="headerlink" title="猜数字"></a>猜数字</h2><ol>
<li>猜数字<br>这个项目非常简单，它涉及到随机数的生成和用户输入操作。<br>我们使用了bufio库来处理输入数据。</li>
</ol>
<pre><code class="go">reader := bufio.NewReader(os.Stdin)
input, _ := reader.ReadString(&#39;\n&#39;)
</code></pre>
<h2 id="简单字典"><a href="#简单字典" class="headerlink" title="简单字典"></a>简单字典</h2><ol start="2">
<li>标准库strconv<br>它主要用于字符和其他类型之间的转换。</li>
</ol>
<pre><code class="go">strconv.Atoi(s string) int 
</code></pre>
<ol start="3">
<li>标准库strings</li>
</ol>
<pre><code class="go">strings.TrimSuffix(s string ,  suffix string) string
</code></pre>
<p>删除末尾字符，如果没有就正常返回</p>
<ol start="4">
<li>网络库</li>
</ol>
<pre><code class="go">client := &amp;http.Client&#123;&#125;
</code></pre>
<p>初始化请求客户端</p>
<pre><code class="go">req,  err := http.NewRequest(&quot;POST&quot;, &quot;https://api.interpreter.caiyunai.com/v1/dict&quot;,  data)
</code></pre>
<p>构造头</p>
<pre><code class="go">req.Header.Set(&quot;authority&quot;,  &quot;api.interpreter.caiyunai.com&quot;)
</code></pre>
<p>请求</p>
<pre><code class="go">bodyText,  err := io.ReadAll(resp.Body)
err = json.Unmarshal(bodyText,  &amp;dictResponse)
</code></pre>
<ol start="5">
<li>os库</li>
</ol>
<pre><code class="go">word := os.Args[1]
</code></pre>
<p>获取环境参数</p>
<h2 id="socks5代理"><a href="#socks5代理" class="headerlink" title="socks5代理"></a>socks5代理</h2><pre><code class="go">package main

import (
    &quot;context&quot;
    &quot;encoding/binary&quot;
    &quot;fmt&quot;
    &quot;io&quot;
    &quot;net&quot;
)

const (
    socks5Ver  = 0x05
    atypeIPV4  = 0x01
    atypeHOST  = 0x03
    cmdConnect = 0x01
)

func main() &#123;
    // 假设在这里建立一个 net.Listener 监听 Socks5 代理请求

    for &#123;
        client, err := acceptConnection()
        if err != nil &#123;
            continue
        &#125;

        // 开启一个 goroutine 处理客户端请求
        go handleSocks5Client(client)
    &#125;
&#125;

func acceptConnection() (net.Conn, error) &#123;
    // 实现接收连接请求的逻辑
&#125;

func handleSocks5Client(conn net.Conn) &#123;
    defer conn.Close()

    // 鉴权阶段
    if err := auth(conn); err != nil &#123;
        fmt.Println(&quot;Authentication error:&quot;, err)
        return
    &#125;

    // 通讯阶段
    addr, err := connect(conn)
    if err != nil &#123;
        fmt.Println(&quot;Connection error:&quot;, err)
        return
    &#125;

    // 给客户端回包，表示连接成功
    _, _ = conn.Write([]byte&#123;socks5Ver, 0x00, 0x00, atypeIPV4, 0, 0, 0, 0, 0, 0&#125;)

    // 开始进行数据转发
    dest, err := net.Dial(&quot;tcp&quot;, addr)
    if err != nil &#123;
        fmt.Println(&quot;Failed to connect to destination:&quot;, err)
        return
    &#125;
    defer dest.Close()

    ctx, cancel := context.WithCancel(context.Background())
    defer cancel()

    // 从客户端到目标地址的数据拷贝
    go func() &#123;
        _, _ = io.Copy(dest, conn)
        cancel()
    &#125;()

    // 从目标地址到客户端的数据拷贝
    go func() &#123;
        _, _ = io.Copy(conn, dest)
        cancel()
    &#125;()

    &lt;-ctx.Done()
&#125;

func auth(conn net.Conn) error &#123;
    buf := make([]byte, 2)
    _, err := io.ReadFull(conn, buf)
    if err != nil &#123;
        return err
    &#125;

    ver, nmethods := buf[0], buf[1]
    methods := make([]byte, nmethods)
    _, err = io.ReadFull(conn, methods)
    if err != nil &#123;
        return err
    &#125;

    // 在这里根据收到的 methods 进行认证处理

    // 假设这里选择不需要认证，回包告知客户端不需要认证
    _, err = conn.Write([]byte&#123;socks5Ver, 0x00&#125;)
    if err != nil &#123;
        return err
    &#125;

    return nil
&#125;

func connect(conn net.Conn) (string, error) &#123;
    buf := make([]byte, 4)
    _, err := io.ReadFull(conn, buf)
    if err != nil &#123;
        return &quot;&quot;, err
    &#125;

    ver, cmd, _, atyp := buf[0], buf[1], buf[2], buf[3]
    if ver != socks5Ver || cmd != cmdConnect &#123;
        return &quot;&quot;, fmt.Errorf(&quot;Unsupported SOCKS5 command&quot;)
    &#125;

    var addr string
    switch atyp &#123;
    case atypeIPV4:
        buf := make([]byte, 4)
        _, err := io.ReadFull(conn, buf)
        if err != nil &#123;
            return &quot;&quot;, err
        &#125;
        addr = fmt.Sprintf(&quot;%d.%d.%d.%d&quot;, buf[0], buf[1], buf[2], buf[3])

    case atypeHOST:
        hostSizeBuf := make([]byte, 1)
        _, err := io.ReadFull(conn, hostSizeBuf)
        if err != nil &#123;
            return &quot;&quot;, err
        &#125;
        hostSize := int(hostSizeBuf[0])
        hostBuf := make([]byte, hostSize)
        _, err = io.ReadFull(conn, hostBuf)
        if err != nil &#123;
            return &quot;&quot;, err
        &#125;
        addr = string(hostBuf)
    &#125;

    portBuf := make([]byte, 2)
    _, err = io.ReadFull(conn, portBuf)
    if err != nil &#123;
        return &quot;&quot;, err
    &#125;
    port := binary.BigEndian.Uint16(portBuf)

    return fmt.Sprintf(&quot;%v:%v&quot;, addr, port), nil
&#125;
</code></pre>
<p>使用 SOCKS5 代理的实现，涵盖了以下主要步骤：</p>
<p>鉴权阶段：</p>
<p>解析客户端发送的版本号、支持的认证方法数量和认证方法列表。<br>针对支持的认证方法进行验证，返回认证成功的回包。<br>通讯阶段：</p>
<p>解析客户端发送的连接请求，包括版本号、命令类型、目标地址类型、目标地址、目标端口等信息。<br>根据目标地址类型和地址解析方式，获取目标地址和端口号。<br>向目标地址发起连接请求，并返回连接成功的回包。<br>进程管理：</p>
<p>使用 goroutine 后台开启两个服务器交互进程。<br>通过 context 库进行进程管理，确保进程在必要时可以被关闭。<br>将客户端和目标之间的数据互相拷贝，使得数据能够在两者之间传递。</p>
<h2 id="四、课后个人总结："><a href="#四、课后个人总结：" class="headerlink" title="四、课后个人总结："></a>四、课后个人总结：</h2><p>在这节课学习的内容中，我收获了很多关于Go语言编程的知识和技能。以下是我的感想：</p>
<p>Go语言的简洁和高效：通过学习这些基础标准库和相关功能，我深刻感受到Go语言的简洁和高效。标准库提供了丰富的功能，让编程变得更加简单和高效。</p>
<p>数据类型转换和字符串处理：学习了strconv和strings包，对于数据类型转换和字符串处理有了更深入的了解。这些工具使得在处理用户输入和数据转换时更加方便。</p>
<p>网络编程和HTTP库：了解了Go语言中的网络编程和net&#x2F;http包，我现在能够编写简单的HTTP服务器和客户端，这对于开发网络应用和服务端程序非常有用。</p>
<p>文件操作和系统交互：通过os包的学习，我学会了如何在Go语言中进行文件操作和与操作系统进行交互，这对于处理文件和系统配置十分重要。</p>
<p>代理和鉴权：学习了socks5代理和鉴权机制，我对网络代理和安全认证有了更深刻的理解，这对于开发安全性较高的应用非常重要。</p>
<p>上下文处理：context包的学习使我了解了在Go语言中如何优雅地处理请求上下文，更好地控制请求的流程和生命周期。</p>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2023/05/08/%E6%8C%91%E6%88%98%EF%BC%9A%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E7%AE%A1%E7%90%86/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 24.305555555555554%;">
                    <img data-src="/images/background/xiaomai.jpg" data-sizes="auto" alt="LINUX 挑战：用户和组管理" class="lazyload">
                    <h1>LINUX 挑战：用户和组管理</h1>
                </div>
            
        </a>
        
        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2023年05月08日</a>
            <a><i class="nexmoefont icon-areachart"></i>242 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>
        
        <article>
            
                <h1 id="LINUX-挑战：用户和组管理"><a href="#LINUX-挑战：用户和组管理" class="headerlink" title="LINUX 挑战：用户和组管理"></a>LINUX 挑战：用户和组管理</h1><ol>
<li></li>
</ol>
<pre><code>wget https://labfile.oss.aliyuncs.com/courses/2585/06.tar.gz
tar -xzf 06.tar.gz
chmod 700 ./06.sh
./06.sh
</code></pre>
<ol start="2">
<li></li>
</ol>
<pre><code>sudo userdel guest2
sudo userdel guest3
sudo userdel guest4
sudo userdel guest5

sudo rm -rf /home/guest2
sudo rm -rf /home/guest3
sudo rm -rf /home/guest4
sudo rm -rf /home/guest5

sudo groupadd guest
mkdir /tmp/tempuser
sudo usermod -u 2000 -g guest -d /tmp/tempuser guest1 
</code></pre>
<ol start="3">
<li></li>
</ol>
<pre><code>sudo mkdir /home/vsftpduser
sudo useradd vsftpduser -d /home/vsftpduser -s /usr/sbin/nologin 

sudo chown vsftpduser /home/vsftpduser
sudo chgrp vsftpduser /home/vsftpduser
sudo chmod 744 /home/vsftpduser
</code></pre>
<ol start="4">
<li></li>
</ol>
<pre><code>sudo useradd mag
sudo useradd dev
sudo useradd test

sudo mkdir /srv/projectx/mag
sudo mkdir /srv/projectx/dev
sudo mkdir /srv/projectx/test

sudo usermod -G dev mag
sudo chown dev:dev /srv/projectx
sudo chmod 751 /srv/projectx

sudo chmod o+rx /srv/projectx/dev
sudo chmod o+rx /srv/projectx/test
</code></pre>
<ol start="5">
<li></li>
</ol>
<pre><code>cat /etc/passwd | grep bash | cut -d &#39;:&#39; -f 1,3 &gt; users.txt
</code></pre>
<ol start="6">
<li></li>
</ol>
<pre><code>sudo useradd stu
sudo passwd stu
123456
123456

sudo visudo
:21
# 按i往里写
stu ALL=(shiyanlou:shiyanlou) /bin/touch
# 退出按:wq
</code></pre>
<ol start="7">
<li></li>
</ol>
<pre><code>sudo passwd dev
123456
123456

sudo touch /etc/sudoers.d/dev
sudo chmod 777 /etc/sudoers.d/dev
vim /etc/sudoers.d/dev
# 按i往里写
dev  ALL=(root:root) /usr/sbin/useradd
# 退出按:wq
</code></pre>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2023/02/08/Web%20%E5%BC%80%E5%8F%91%E5%AE%89%E5%85%A8%20%EF%BD%9C%20%E9%9D%92%E8%AE%AD%E8%90%A5%E7%AC%94%E8%AE%B0/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 24.305555555555554%;">
                    <img data-src="/images/background/xiaomai.jpg" data-sizes="auto" alt="Web 开发安全 ｜ 青训营笔记" class="lazyload">
                    <h1>Web 开发安全 ｜ 青训营笔记</h1>
                </div>
            
        </a>
        
        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2023年02月08日</a>
            <a><i class="nexmoefont icon-areachart"></i>845 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 3 分钟</a>
        </div>
        
        <article>
            
                <p><strong>这是我参与「第五届青训营」伴学笔记创作活动的第 17 天</strong></p>
<h2 id="课程重点"><a href="#课程重点" class="headerlink" title="课程重点"></a>课程重点</h2><ul>
<li><p>Web 相关的攻击介绍</p>
</li>
<li><p>Web 相关的防御介绍</p>
</li>
</ul>
<h2 id="详细介绍"><a href="#详细介绍" class="headerlink" title="详细介绍"></a>详细介绍</h2><h3 id="XSS-Cross-Site-Scripting"><a href="#XSS-Cross-Site-Scripting" class="headerlink" title="XSS (Cross-Site Scripting)"></a>XSS (Cross-Site Scripting)</h3><p>主要是由于盲目信任用户输入，直接将用户输入渲染出来，导致了攻击脚本的植入</p>
<p>特点：</p>
<ol>
<li>通常难以从 UI 上感知</li>
<li>窃取用户信息，例如 cookie 和 token</li>
</ol>
<p>常见的会导致XSS的代码：</p>
<pre><code>document.write
el.innerHTML = anyString
</code></pre>
<p>总结来说，所有能够渲染dom结构的函数，都有可能导致XSS攻击。</p>
<p>比如论坛场景中，<strong>用户提交的内容包含恶意script标签</strong></p>
<pre><code class="js">fetch(&quot;/submit&quot;, &#123;
    body: JSON.stringify(&#123;
        id: &quot;1&quot;,
        content: `&lt;script&gt;alert(&quot;xss&quot;);&lt;/script&gt;`
    &#125;)
&#125;)
</code></pre>
<p>导致代码被插入到帖子中，所有用户访问页面都会执行恶意脚本</p>
<p>XSS 能够分成下面四类</p>
<p><code>Stored XSS</code> 直接将恶意脚本储存到了数据库中，导致之后的所有访问均会携带恶意脚本，危害很大</p>
<pre><code>Reflected XSS` 反射型，不储存数据，仅仅从URL传入脚本导致攻击，例如 `/path?param=&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;
</code></pre>
<p><code>DOM-based XSS</code> 不由服务器参与，攻击的发起和执行都在浏览器，常见于前端框架中</p>
<p><code>Mutation-based XSS</code> 利用浏览器的特性，不同浏览器会有区别，例如</p>
<pre><code>&lt;noscript&gt;&lt;p title=&quot;&lt;/noscript&gt;&lt;img src=x onerror=alert(1)&gt;&quot;&gt;
</code></pre>
<h3 id="CSRF-Cross-site-request-forgery"><a href="#CSRF-Cross-site-request-forgery" class="headerlink" title="CSRF (Cross-site request forgery)"></a>CSRF (Cross-site request forgery)</h3><p>特点：</p>
<ol>
<li>在用户不知情的前提下</li>
<li>利用用户权限（cookie）</li>
<li>构造指定HTTP请求，窃取或修改用户敏感信息</li>
</ol>
<p>例子：</p>
<p>用户没有访问银行网页，但是访问了一个带有攻击内容的网页，该网页尝试请求银行接口，由于用户登录过银行，接口携带cookie，导致请求成功，使得用户受到损失。</p>
<h3 id="SQL-注入-SQL-Injection"><a href="#SQL-注入-SQL-Injection" class="headerlink" title="SQL 注入 (SQL Injection)"></a>SQL 注入 (SQL Injection)</h3><p>在请求参数中构造恶意字符串，拼接SQL语句，导致服务器执行了特定的SQL语句，造成数据库内容泄露</p>
<p>例子：</p>
<pre><code class="js">sql.query(`
    SELECT a, b, c FROM table
    WHERE username = $&#123;username&#125;
    AND form_id = $&#123;form_id&#125;
`)
</code></pre>
<p>上面的这段后端代码，攻击者就能够通过构造特殊的 username 或 form_id，使得SQL语句的意义被改变</p>
<p>例如传入 form_id &#x3D; <code>any; DROP TABLE table;</code></p>
<p>SQL 语句拼接后变成 <code>SELECT a,b,c FROM table WHERE xxxx AND form_id = any; DROP TABLE table;</code></p>
<p>将导致数据库被删除</p>
<h3 id="SSRF-Server-Side-Request-Forgery"><a href="#SSRF-Server-Side-Request-Forgery" class="headerlink" title="SSRF (Server-Side Request Forgery)"></a>SSRF (Server-Side Request Forgery)</h3><p>服务端伪造请求</p>
<p>例子：</p>
<pre><code>ctx.body = await fetch(ctx.query.callback)
</code></pre>
<p>导致能够通过传入的参数访问到服务器内网的相关服务</p>
<h3 id="DoS-Denial-of-Service"><a href="#DoS-Denial-of-Service" class="headerlink" title="DoS (Denial of Service)"></a>DoS (Denial of Service)</h3><p><code>「 不搞复杂的 ， 量大就完事儿了 」</code></p>
<p>通过构造特定请求，导致服务器资源被消耗，来不及响应更多请求，引发雪崩效应</p>
<p>例如：</p>
<ol>
<li>耗时的同步操作</li>
<li>文件备份</li>
<li>数据库写入</li>
<li>SQL join</li>
<li>循环执行逻辑</li>
</ol>
<h4 id="DDoS-Distributed-DoS"><a href="#DDoS-Distributed-DoS" class="headerlink" title="DDoS (Distributed DoS)"></a>DDoS (Distributed DoS)</h4><p>攻击特点</p>
<ul>
<li>直接访问 IP</li>
<li>任意 API</li>
<li>消耗大量带宽 （ 耗尽 ）</li>
</ul>
<p>SYN Flood</p>
<h2 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a>尾声</h2><p>安全无小事<br>使用的依赖 npm package，甚至是 NodeJS 可能成为最薄弱的一环</p>
<ul>
<li>保持学习心态<br>npm install 除了带来了果洞 ， 还可以带来漏洞</li>
</ul>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p><a target="_blank" rel="noopener" href="https://bytedance.feishu.cn/file/boxcn9L4YzmTK3mwE3tIBL2UVme">https://bytedance.feishu.cn/file/boxcn9L4YzmTK3mwE3tIBL2UVme</a></p>
<p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/XSS%E6%94%BB%E5%87%BB/954065">https://baike.baidu.com/item/XSS%E6%94%BB%E5%87%BB/954065</a></p>

            
        </article>
    </div>
    
</section>

    <nav class="nexmoe-page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/archives/2023/page/2/">2</a><a class="page-number" href="/archives/2023/page/3/">3</a><a class="extend next" rel="next" href="/archives/2023/page/2/"><i class="nexmoefont icon-right"></i></a>
    </nav>
  

        <div class="nexmoe-post-right">
          
            <div class="nexmoe-fixed">
              <div class="nexmoe-tool">
                <a href="#" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
              </div>
            </div>
          
        </div>
    </div>
  </div>
  <div id="nexmoe-pendant">
    <div class="nexmoe-drawer mdui-drawer nexmoe-pd" id="drawer">
        
            <div class="nexmoe-pd-item">
                <div class="clock">
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="needle" id="hours"></div>
        <div class="needle" id="minutes"></div>
        <div class="needle" id="seconds"></div>
        <div class="clock_logo">

        </div>

    </div>
<style>
    .clock {
        background-color: #ffffff;
        width: 70vw;
        height: 70vw;
        max-width: 70vh;
        max-height: 70vh;
        border: solid 2.8vw #242424;
        position: relative;
        overflow: hidden;
        border-radius: 50%;
        box-sizing: border-box;
        box-shadow: 0 1.4vw 2.8vw rgba(0, 0, 0, 0.8);
        zoom:0.2
    }

    .memory {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center;
    }

    .memory:nth-child(1) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(0deg) translateY(-520%);
    }

    .memory:nth-child(2) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(6deg) translateY(-1461%);
    }

    .memory:nth-child(3) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(12deg) translateY(-1461%);
    }

    .memory:nth-child(4) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(18deg) translateY(-1461%);
    }

    .memory:nth-child(5) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(24deg) translateY(-1461%);
    }

    .memory:nth-child(6) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(30deg) translateY(-520%);
    }

    .memory:nth-child(7) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(36deg) translateY(-1461%);
    }

    .memory:nth-child(8) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(42deg) translateY(-1461%);
    }

    .memory:nth-child(9) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(48deg) translateY(-1461%);
    }

    .memory:nth-child(10) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(54deg) translateY(-1461%);
    }

    .memory:nth-child(11) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(60deg) translateY(-520%);
    }

    .memory:nth-child(12) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(66deg) translateY(-1461%);
    }

    .memory:nth-child(13) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(72deg) translateY(-1461%);
    }

    .memory:nth-child(14) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(78deg) translateY(-1461%);
    }

    .memory:nth-child(15) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(84deg) translateY(-1461%);
    }

    .memory:nth-child(16) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(90deg) translateY(-520%);
    }

    .memory:nth-child(17) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(96deg) translateY(-1461%);
    }

    .memory:nth-child(18) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(102deg) translateY(-1461%);
    }

    .memory:nth-child(19) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(108deg) translateY(-1461%);
    }

    .memory:nth-child(20) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(114deg) translateY(-1461%);
    }

    .memory:nth-child(21) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(120deg) translateY(-520%);
    }

    .memory:nth-child(22) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(126deg) translateY(-1461%);
    }

    .memory:nth-child(23) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(132deg) translateY(-1461%);
    }

    .memory:nth-child(24) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(138deg) translateY(-1461%);
    }

    .memory:nth-child(25) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(144deg) translateY(-1461%);
    }

    .memory:nth-child(26) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(150deg) translateY(-520%);
    }

    .memory:nth-child(27) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(156deg) translateY(-1461%);
    }

    .memory:nth-child(28) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(162deg) translateY(-1461%);
    }

    .memory:nth-child(29) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(168deg) translateY(-1461%);
    }

    .memory:nth-child(30) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(174deg) translateY(-1461%);
    }

    .memory:nth-child(31) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(180deg) translateY(-520%);
    }

    .memory:nth-child(32) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(186deg) translateY(-1461%);
    }

    .memory:nth-child(33) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(192deg) translateY(-1461%);
    }

    .memory:nth-child(34) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(198deg) translateY(-1461%);
    }

    .memory:nth-child(35) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(204deg) translateY(-1461%);
    }

    .memory:nth-child(36) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(210deg) translateY(-520%);
    }

    .memory:nth-child(37) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(216deg) translateY(-1461%);
    }

    .memory:nth-child(38) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(222deg) translateY(-1461%);
    }

    .memory:nth-child(39) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(228deg) translateY(-1461%);
    }

    .memory:nth-child(40) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(234deg) translateY(-1461%);
    }

    .memory:nth-child(41) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(240deg) translateY(-520%);
    }

    .memory:nth-child(42) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(246deg) translateY(-1461%);
    }

    .memory:nth-child(43) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(252deg) translateY(-1461%);
    }

    .memory:nth-child(44) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(258deg) translateY(-1461%);
    }

    .memory:nth-child(45) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(264deg) translateY(-1461%);
    }

    .memory:nth-child(46) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(270deg) translateY(-520%);
    }

    .memory:nth-child(47) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(276deg) translateY(-1461%);
    }

    .memory:nth-child(48) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(282deg) translateY(-1461%);
    }

    .memory:nth-child(49) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(288deg) translateY(-1461%);
    }

    .memory:nth-child(50) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(294deg) translateY(-1461%);
    }

    .memory:nth-child(51) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(300deg) translateY(-520%);
    }

    .memory:nth-child(52) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(306deg) translateY(-1461%);
    }

    .memory:nth-child(53) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(312deg) translateY(-1461%);
    }

    .memory:nth-child(54) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(318deg) translateY(-1461%);
    }

    .memory:nth-child(55) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(324deg) translateY(-1461%);
    }

    .memory:nth-child(56) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(330deg) translateY(-520%);
    }

    .memory:nth-child(57) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(336deg) translateY(-1461%);
    }

    .memory:nth-child(58) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(342deg) translateY(-1461%);
    }

    .memory:nth-child(59) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(348deg) translateY(-1461%);
    }

    .memory:nth-child(60) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(354deg) translateY(-1461%);
    }

    .needle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center;
    }

    .needle#hours {
        background-color: #1f1f1f;
        width: 4%;
        height: 30%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#hours.moving {
        transition: transform 150ms ease-out;
    }

    .needle#hours:after {
        content: '';
        background-color: #1f1f1f;
        width: 4vw;
        height: 4vw;
        max-width: 4vh;
        max-height: 4vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .needle#minutes {
        background-color: #1f1f1f;
        width: 2%;
        height: 45%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#minutes.moving {
        transition: transform 150ms ease-out;
    }

    .needle#minutes:after {
        content: '';
        background-color: #1f1f1f;
        width: 4vw;
        height: 4vw;
        max-width: 4vh;
        max-height: 4vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .needle#seconds {
        background-color: #cb2f2f;
        width: 1%;
        height: 50%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#seconds.moving {
        transition: transform 150ms ease-out;
    }

    .needle#seconds:after {
        content: '';
        background-color: #cb2f2f;
        width: 2.5vw;
        height: 2.5vw;
        max-width: 2.5vh;
        max-height: 2.5vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }
    .clock_logo{
        width: 10vw;
        height: 10vw;
        max-width: 10vh;
        max-height: 10vh;
        position: absolute;
        top: 50%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }
    @media (min-width: 100vh) {
        .clock {
            border: solid 2.8vh #242424;
            box-shadow: 0 1.4vh 2.8vh rgba(0, 0, 0, 0.8);
        }
    }

</style>





            </div>
        
            <div class="nexmoe-pd-item">
                <div class="qweather" >
    <div id="he-plugin-standard"></div>
    <div class="qweather-logo">

    </div>

</div>
<style>
    .qweather{
        position: relative;
    }
    .qweather-logo{
        position: absolute;
        right: 0;
        top: -15px;
        width: 40px;
        height: 40px;
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }
</style>
<script>
  WIDGET = {
    "CONFIG": {
      "layout": "2",
      "width": "260",
      "height": "220",
      "background": "5",
      "dataColor": "e67249",
      "borderRadius": "15",
      "key": "f74d1e1690e6432d801e97fa2f05a162"
    }
  }
</script>
<script src="https://widget.qweather.net/standard/static/js/he-standard-common.js?v=2.0"></script>

            </div>
        
</div>
<style>
    .nexmoe-pd {
        left: auto;
        top: 40px;
        right: 0;
    }
    .nexmoe-pd-item{
       display: flex;
        justify-content: center;
        margin-bottom: 30px;
    }
</style>

  </div>
  <script src="https://unpkg.com/lazysizes@5.1.0/lazysizes.min.js"></script>
<script src="https://cdn.staticfile.org/highlight.js/10.0.0/highlight.min.js"></script>
<script src="https://unpkg.com/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>

<script>
	hljs.initHighlightingOnLoad();
</script>

<script src="https://unpkg.com/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="/lib/fancybox/js/jquery.fancybox.min.js"></script>


<script src="/js/app.js?v=1695140390215"></script>

<script src="https://unpkg.com/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>

  





<!-- hexo injector body_end start -->
<script src="/js/clock.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.js"></script>

<script src="/js/search.js"></script>

<script src="https://unpkg.com/clipboard@2.0.8/dist/clipboard.min.js"></script>

<script src="/lib/codeBlock/codeBlockFuction.js"></script>

<script src="/lib/codeBlock/codeLang.js"></script>

<script src="/lib/codeBlock/codeCopy.js"></script>

<script src="/lib/codeBlock/codeShrink.js"></script>

<link rel="stylesheet" href="/lib/codeBlock/matery.css">

<script src="/js/webapp.js"></script>
<!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/xiaomai.model.json"},"display":{"superSample":2,"width":300,"height":600,"position":"right","hOffset":0,"vOffset":80},"mobile":{"show":false},"react":{"opacity":1},"log":false});</script></body>
</html>

<script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/16ad17e2.js","daovoice")</script>
<script>
  daovoice('init', {
    app_id: "16ad17e2"
  });
  daovoice('update');
</script>

